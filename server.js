import express from "express";
import dotenv from "dotenv";
import cors from "cors";
import path from "path";
import { fileURLToPath } from "url";
import formData from "form-data";
import Mailgun from "mailgun.js";
import fetch from "node-fetch";// ‚úÖ needed for QPay API calls
import bodyParser from "body-parser";
import fs from "fs";
// ---------------------------
// Setup
// ---------------------------
dotenv.config();
const app = express();
app.use(cors());
app.use(express.json());

// For ES modules
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Serve front-end files
app.use(express.static(path.join(__dirname)));

// ---------------------------
// Email transporter (Mailgun)
// ---------------------------
const mailgun = new Mailgun(formData);
const mg = mailgun.client({
  username: "api",
  key: process.env.MAILGUN_API_KEY,
  url: "https://api.eu.mailgun.net",
});

// ---------------------------
// üîπ QPay Integration
// ---------------------------
// ---------------------------
// üîπ QPay Integration
// ---------------------------
// ---------------------------
// üîπ QPay Integration (Fixed)
// ---------------------------
const QPAY_BASE_URL = process.env.QPAY_SANDBOX === "true"
  ? "https://merchant-sandbox.qpay.mn/v2"
  : "https://merchant.qpay.mn/v2";

const QPAY_USERNAME = process.env.QPAY_USERNAME;
const QPAY_PASSWORD = process.env.QPAY_PASSWORD;
const QPAY_INVOICE_CODE = process.env.QPAY_INVOICE_CODE; // Must match QPay dashboard

// Encode credentials for Basic Auth
const basicAuth = Buffer.from(`${QPAY_USERNAME}:${QPAY_PASSWORD}`).toString("base64");

// Get access token
async function getAccessToken() {
  const res = await fetch(`${QPAY_BASE_URL}/auth/token`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Basic ${basicAuth}`,
    },
  });
  let data;
  try {
    data = await res.json();
  } catch (e) {
    console.error("‚ùå Failed to parse QPay auth response:", e);
    throw e;
  }

  if (!res.ok || !data.access_token) {
    console.error("‚ùå QPay auth error:", data);
    throw new Error("Failed to get QPay token");
  }

  return data.access_token;
}

// Create a new invoice
async function createInvoice({ amount, email, testType }) {
  const token = await getAccessToken();

  const invoiceData = {
    invoice_code: process.env.QPAY_INVOICE_CODE, // must be live invoice code
    sender_invoice_no: Date.now().toString(),
    invoice_receiver_code: "terminal",
    invoice_description: `–¢–µ—Å—Ç–∏–π–Ω —Ç”©–ª–±”©—Ä (${testType})`,
    amount,
  };

  console.log("üü¢ Sending to QPay:", invoiceData);

  const res = await fetch(`${QPAY_BASE_URL}/invoice`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${token}`,
    },
    body: JSON.stringify(invoiceData),
  });

  const text = await res.text(); // üîπ log raw response
  console.log("üü¢ QPay raw response:", text);

  let data;
  try {
    data = JSON.parse(text);
  } catch (e) {
    console.error("‚ùå Failed to parse JSON from QPay:", e);
    throw new Error("Invalid JSON response from QPay (check logs for HTML/error)");
  }

  if (!res.ok || !data.invoice_id) {
    console.error("‚ùå QPay invoice creation failed:", data);
    throw new Error("Failed to create invoice");
  }

  console.log(`‚úÖ Invoice created for ${email}:`, data.invoice_id);
  return data;
}


// Check payment status
async function checkPayment(invoiceId) {
  const token = await getAccessToken();

  const res = await fetch(`${QPAY_BASE_URL}/payment/check`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: `Bearer ${token}`,
    },
    body: JSON.stringify({
      object_type: "INVOICE",
      object_id: invoiceId,
    }),
  });

  let data;
  try {
    data = await res.json();
  } catch (e) {
    console.error("‚ùå Failed to parse JSON from QPay payment check:", e);
    throw e;
  }

  if (!res.ok) {
    console.error("‚ùå QPay payment check error:", data);
    throw new Error("Failed to check payment");
  }

  return data;
}

// ---------------------------
// üí≥ Endpoint: Start payment
// ---------------------------
app.post("/start-payment", async (req, res) => {
  try {
    const { email, testType } = req.body;
    const amount = 1; // price in MNT

    const invoice = await createInvoice({ amount, email, testType });

    // Return QR image & invoice_id to frontend
    res.json({
      success: true,
      invoice_id: invoice.invoice_id,
      qr_image: invoice.qr_image,
      urls: invoice.urls, // bank app URLs
    });
  } catch (err) {
    console.error("‚ùå Failed to start QPay payment:", err);
    res.status(500).json({ success: false, message: err.message });
  }
});

// ---------------------------
// üí∞ Endpoint: Check payment & send email
// ---------------------------
app.post("/check-payment", async (req, res) => {
  const { invoice_id, email, score, testType } = req.body;

  try {
    const payment = await checkPayment(invoice_id);

    const isPaid =
      payment.payment_status === "PAID" ||
      (payment.rows && payment.rows.some((p) => p.payment_status === "PAID"));

    if (isPaid) {
      console.log(`üí∏ Payment confirmed for ${email}`);

      const subject = `${testType} ‚Äî –¢–∞–Ω—ã “Ø—Ä –¥“Ø–Ω üéâ`;
      const text = `–°–∞–π–Ω –±–∞–π–Ω–∞ —É—É!\n\n"${testType}" —Ç–µ—Å—Ç–∏–π–Ω —Ç–∞–Ω—ã –æ–Ω–æ–æ: ${score}/150\n\n–ë–∞—è—Ä —Ö“Ø—Ä–≥—ç–µ, —Ç–∞–Ω—ã —Ç”©–ª–±”©—Ä –∞–º–∂–∏–ª—Ç—Ç–∞–π –±–∞—Ç–∞–ª–≥–∞–∞–∂—Å–∞–Ω.\n\nINNER.mn –±–∞–≥`;

      await mg.messages.create(process.env.MAILGUN_DOMAIN, {
        from: `INNER <postmaster@${process.env.MAILGUN_DOMAIN}>`,
        to: [email],
        subject,
        text,
      });

      return res.json({
        success: true,
        paid: true,
        message: "Payment confirmed and email sent.",
      });
    } else {
      return res.json({
        success: true,
        paid: false,
        message: "Payment not yet completed.",
      });
    }
  } catch (err) {
    console.error("‚ùå Error checking payment:", err);
    res.status(500).json({ success: false, message: "Failed to verify payment" });
  }
});

// ---------------------------
// Existing: POST /send-results
// ---------------------------
// app.post("/send-results", async (req, res) => {
//   const { email, score, testType } = req.body;
//   let interpretation = "";
//   let explanation = "";

//   if (!email || (!score && score !== 0) || !testType) {
//     return res.status(400).json({ success: false, message: "Invalid input" });
//   }

//   // Interpret result
//   if (testType === "sectionsTest1") {
//     if (score >= 121) {
//       interpretation =
//         "–¢–∞–Ω—ã —Ö–∞—Ä–∏–ª—Ü–∞–∞–Ω–¥ —Ç–æ–∫—Å–∏–∫ –∑–∞–Ω —Ç”©–ª”©–≤ –º–∞—à —Ç–æ–¥ –∏–ª—ç—Ä—á –±–∞–π–Ω–∞. –•—è–Ω–∞–ª—Ç —Ç–∞–≤–∏—Ö, –±—É—Å–¥—ã–≥ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏ —Ö–∏–π—Ö, –±–∞–π–Ω–≥–∞ –±—É—Ä—É—É—Ç–≥–∞—Ö, —É—É—Ä –±—É—Ö–∏–º–¥–∞–ª—Ç–∞–π –±–∞–π—Ö –∑—ç—Ä—ç–≥ –Ω—å —Ç–∞–Ω—ã —Ö–∞—Ä–∏–ª—Ü–∞–∞–≥ –Ω–æ—Ü—Ç–æ–π–≥–æ–æ—Ä —Ö–æ—Ä–¥—É—É–ª–∂ –±–∞–π–Ω–∞. –≠–Ω—ç –Ω—å —Ç–∞–Ω—ã —Ö—É–≤–∏–π–Ω –∞–º—å–¥—Ä–∞–ª –±–æ–ª–æ–Ω –æ–π—Ä –¥–æ—Ç–Ω—ã —Ö“Ø–º“Ø“Ø—Å—Ç —Ç–∞–Ω—å —Å”©—Ä–≥”©”©—Ä –Ω”©–ª”©”©–ª–∂ –±–∞–π–≥–∞–∞ —Ç—É–ª –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω —Å—ç—Ç–≥—ç–ª –∑“Ø–π—á–∏–π–Ω —Ç—É—Å–ª–∞–º–∂ –∞–≤–∞—Ö—ã–≥ –∑”©–≤–ª”©–∂ –±–∞–π–Ω–∞.";
//     } else if (score >= 91 && score <= 120) {
//       interpretation =
//         "–¢–∞–Ω—ã —Ö–∞—Ä–∏–ª—Ü–∞–∞–Ω–¥ —Ç–æ–∫—Å–∏–∫ –∑–∞–Ω —Ç”©–ª”©–≤–∏–π–Ω —à–∏–Ω–∂ —Ç—ç–º–¥—ç–≥ –Ω—ç–ª—ç—ç–¥ –∏—Ö –±–∞–π–Ω–∞. –ë—É—Å–¥—ã–≥ —É–¥–∏—Ä–¥–∞—Ö, —à“Ø“Ø–º–∂–ª—ç—Ö, —Å—ç—Ç–≥—ç–ª —Å–∞–Ω–∞–∞–Ω—ã —Ö—É–≤—å–¥ –¥–∞—Ä–∞–º—Ç–ª–∞—Ö, —Ö–∞—Ä–∏—É—Ü–ª–∞–≥–∞–∞—Å –∑–∞–π–ª—Å—Ö–∏–π—Ö –∑—ç—Ä—ç–≥ –∞—Å—É—É–¥–ª—É—É–¥ –≥–∞—Ä—á –±–æ–ª–∑–æ—à–≥“Ø–π. –≠–¥–≥—ç—ç—Ä –∑–∞–Ω —Ç”©–ª”©–≤ –Ω—å —Ç–∞–Ω—ã —Ö—É–≤–∏–π–Ω –±–æ–ª–æ–Ω –±—É—Å–¥—ã–Ω –∞–º—å–¥—Ä–∞–ª–¥ —Å”©—Ä–≥”©”©—Ä –Ω”©–ª”©”©–ª–∂ –±–∞–π–Ω–∞.";
//     } else if (score >= 61 && score <= 90) {
//       interpretation =
//         "–¢–∞–Ω—ã —Ö–∞—Ä–∏–ª—Ü–∞–∞–Ω–¥ —Ç–æ–∫—Å–∏–∫ –∑–∞–Ω —Ç”©–ª”©–≤–∏–π–Ω –∑–∞—Ä–∏–º —à–∏–Ω–∂ —Ç—ç–º–¥—ç–≥ –∞–∂–∏–≥–ª–∞–≥–¥–∞–∂ –º–∞–≥–∞–¥–≥“Ø–π. –ó–∞—Ä–∏–º–¥–∞–∞ —Ö—è–Ω–∞—Ö, —à“Ø“Ø–º–∂–ª—ç—Ö, —ç—Å–≤—ç–ª –±—É—Å–¥—ã–Ω –º—ç–¥—Ä—ç–º–∂–∏–π–≥ “Ø–ª —Ç–æ–æ–º—Å–æ—Ä–ª–æ—Ö –∑—ç—Ä—ç–≥ –±–∞–π–¥–∞–ª –∏–ª—ç—Ä—á –±–æ–ª–Ω–æ. ”®”©—Ä–∏–π–Ω —Ö–∞—Ä–∏–ª—Ü–∞–∞–Ω—ã —Ö—ç–≤ –º–∞—è–≥–∏–π–≥ —Å–∞–π–∂—Ä—É—É–ª–∞—Ö–∞–¥ –∞–Ω—Ö–∞–∞—Ä–≤–∞–ª –∑–æ—Ö–∏–Ω–æ.";
//     } else {
//       interpretation =
//         "–¢–∞–Ω—ã —Ö–∞—Ä–∏–ª—Ü–∞–∞–Ω–¥ —Ç–æ–∫—Å–∏–∫ –∑–∞–Ω —Ç”©–ª”©–≤–∏–π–Ω —à–∏–Ω–∂ —Ç—ç–º–¥—ç–≥ –º–∞—à –±–∞–≥–∞ —ç—Å–≤—ç–ª –æ–≥—Ç –±–∞–π—Ö–≥“Ø–π. –¢–∞ –±—É—Å–∞–¥—Ç–∞–π —ç—Ä“Ø“Ø–ª, —ç–µ—Ä—ç–≥ —Ö–∞—Ä–∏–ª—Ü–∞–∞–≥ –±–∏–π –±–æ–ª–≥–æ—Ö—ã–≥ —ç—Ä–º—ç–ª–∑–¥—ç–≥.";
//     }
//     explanation = "–≠–Ω—ç—Ö“Ø“Ø —Ç–µ—Å—Ç –Ω—å –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω –æ–Ω–æ—à–ª–æ–≥–æ–æ –±–∏—à –±”©–≥”©”©–¥ –∑”©–≤—Ö”©–Ω —Ç–∞–Ω—ã —Ö–∞—Ä–∏–ª—Ü–∞–∞–Ω—ã —Ö—ç–≤ –º–∞—è–≥–∏–π–Ω —Ç–∞–ª–∞–∞—Ä—Ö ”©”©—Ä–∏–π–≥”©”© “Ø–Ω—ç–ª—ç—Ö—ç–¥ —Ç—É—Å–ª–∞—Ö –∑–æ—Ä–∏–ª–≥–æ—Ç–æ–π —é–º. –•—ç—Ä—ç–≤ —Ç–∞ ”©”©—Ä–∏–π–Ω —ç—Å–≤—ç–ª –±—É—Å–¥—ã–Ω —Ö–∞—Ä–∏–ª—Ü–∞–∞–Ω –¥–∞—Ö—å —Ç–æ–∫—Å–∏–∫ –∑–∞–Ω —Ç”©–ª”©–≤–∏–π–Ω —Ç–∞–ª–∞–∞—Ä —Å–∞–Ω–∞–∞ –∑–æ–≤–∂ –±–∞–π–≥–∞–∞ –±–æ–ª –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω —Å—ç—Ç–≥—ç–ª –∑“Ø–π—á —ç—Å–≤—ç–ª —Ö–∞—Ä–∏–ª—Ü–∞–∞–Ω—ã –∑”©–≤–ª”©—Ö”©”©—Å —Ç—É—Å–ª–∞–º–∂ –∞–≤–∞—Ö –Ω—å —á—É—Ö–∞–ª. ”®”©—Ä–∏–π–Ω –∑–∞–Ω —Ç”©–ª”©–≤–∏–π–≥ ”©”©—Ä—á–ª”©—Ö –Ω—å —ç—Ö–ª—ç—ç–¥ ”©”©—Ä–∏–π–≥”©”© —Ç–∞–Ω–∏—Ö–∞–∞—Å —ç—Ö—ç–ª–¥—ç–≥.";
//   } else if (testType === "sectionsTest2") {
//     if (score >= 121) {
//       interpretation =
//         "–°—Ç—Ä–µ—Å—Å–∏–π–Ω —Ç“Ø–≤—à–∏–Ω –º–∞—à ”©–Ω–¥”©—Ä. –¢–∞ —Ö“Ø–Ω–¥ —Ö—ç–ª–±—ç—Ä–∏–π–Ω —Å—Ç—Ä–µ—Å—Å—Ç ”©—Ä—Ç—Å”©–Ω –±–∞–π–∂ –±–æ–ª–∑–æ—à–≥“Ø–π –±”©–≥”©”©–¥ –æ–ª–æ–Ω —Ç–æ–æ–Ω—ã —Å—ç—Ç–≥—ç–ª –∑“Ø–π–Ω, –±–∏–µ –º–∞—Ö–±–æ–¥–∏–π–Ω, –∑–∞–Ω —Ç”©–ª”©–≤–∏–π–Ω —à–∏–Ω–∂ —Ç—ç–º–¥–≥“Ø“Ø–¥ –∏–ª—ç—Ä—á –±–∞–π–Ω–∞. –≠–Ω—ç –Ω—å —Ç–∞–Ω—ã —ç—Ä“Ø“Ø–ª –º—ç–Ω–¥—ç–¥ –Ω–æ—Ü—Ç–æ–π –∞—é—É–ª —É—á—Ä—É—É–ª–∂ –±–æ–ª–∑–æ—à–≥“Ø–π —Ç—É–ª —è–∞—Ä–∞–ª—Ç–∞–π –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω —Å—ç—Ç–≥—ç–ª –∑“Ø–π—á —ç—Å–≤—ç–ª —ç–º—á–∏–¥ —Ö–∞–Ω–¥–∞–∂, —Ç—É—Å–ª–∞–º–∂ –∞–≤–∞—Ö—ã–≥ –∑”©–≤–ª”©–∂ –±–∞–π–Ω–∞. –Ø–ª–∞–Ω–≥—É—è–∞ 30-—Ä –∞—Å—É—É–ª—Ç–∞–¥ ”©–Ω–¥”©—Ä –æ–Ω–æ–æ ”©–≥—Å”©–Ω –±–æ–ª –Ω—ç–Ω –¥–∞—Ä—É–π –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω —Ç—É—Å–ª–∞–º–∂ –∞–≤–∞–∞—Ä–∞–π.";
//     } else if (score >= 91 && score <= 120) {
//       interpretation =
//         "–°—Ç—Ä–µ—Å—Å–∏–π–Ω —Ç“Ø–≤—à–∏–Ω –Ω—ç–ª—ç—ç–¥ ”©–Ω–¥”©—Ä. –¢–∞ –±–∞–π–Ω–≥–∞ —Å—Ç—Ä–µ—Å—Å–∏–π–Ω —à–∏–Ω–∂ —Ç—ç–º–¥–≥“Ø“Ø–¥–∏–π–≥ –º—ç–¥—ç—Ä—á, —ç–Ω—ç –Ω—å —Ç–∞–Ω—ã —Å—ç—Ç–≥—ç–ª –∑“Ø–π–Ω –±–æ–ª–æ–Ω –±–∏–µ –º–∞—Ö–±–æ–¥–∏–π–Ω —ç—Ä“Ø“Ø–ª –º—ç–Ω–¥, –∞–∂–ª—ã–Ω –≥“Ø–π—Ü—ç—Ç–≥—ç–ª, —Ö—É–≤–∏–π–Ω —Ö–∞—Ä–∏–ª—Ü–∞–∞–Ω–¥ —Å”©—Ä–≥”©”©—Ä –Ω”©–ª”©”©–ª–∂ –±–∞–π–Ω–∞. –°—Ç—Ä–µ—Å—Å—ç—ç —É–¥–∏—Ä–¥–∞—Ö –∞—Ä–≥–∞ –±–∞—Ä–∏–ª —ç–∑—ç–º—à–∏–∂, —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π –±–æ–ª –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω —Ç—É—Å–ª–∞–º–∂ –∞–≤–∞—Ö —Ç–∞–ª–∞–∞—Ä –±–æ–¥–æ—Ö —Ü–∞–≥ –±–æ–ª–∂—ç—ç.";
//     } else if (score >= 61 && score <= 90) {
//       interpretation =
//         "–°—Ç—Ä–µ—Å—Å–∏–π–Ω —Ç“Ø–≤—à–∏–Ω –¥—É–Ω–¥ –∑—ç—Ä—ç–≥. –¢–∞ –∑–∞—Ä–∏–º–¥–∞–∞ —Å—Ç—Ä–µ—Å—Å–∏–π–Ω —à–∏–Ω–∂ —Ç—ç–º–¥–≥“Ø“Ø–¥–∏–π–≥ –º—ç–¥—ç—Ä–¥—ç–≥ —á, —ç–Ω—ç –Ω—å —Ç–∞–Ω—ã ”©–¥”©—Ä —Ç—É—Ç–º—ã–Ω –∞–º—å–¥—Ä–∞–ª–¥ –∏—Ö—ç—ç—Ö—ç–Ω –Ω”©–ª”©”©–ª”©—Ö–≥“Ø–π –±–∞–π–Ω–∞. –°—Ç—Ä–µ—Å—Å—ç—ç —É–¥–∏—Ä–¥–∞—Ö –∞—Ä–≥–∞ –±–∞—Ä–∏–ª–∞–∞ —Å–∞–π–∂—Ä—É—É–ª–∞—Ö —Ç–∞–ª–∞–∞—Ä –±–æ–¥–æ—Ö –Ω—å –∑“Ø–π—Ç—ç–π.";
//     } else {
//       interpretation =
//         "–°—Ç—Ä–µ—Å—Å–∏–π–Ω —Ç“Ø–≤—à–∏–Ω –º–∞—à –±–∞–≥–∞ —ç—Å–≤—ç–ª –æ–≥—Ç –±–∞–π—Ö–≥“Ø–π. –¢–∞ —Å—Ç—Ä–µ—Å—Å—Ç—ç–π –Ω”©—Ö—Ü”©–ª –±–∞–π–¥–∞–ª–¥ —Å–∞–π–Ω –¥–∞—Å–∞–Ω –∑–æ—Ö–∏—Ü–æ–∂, —Å—ç—Ç–≥—ç–ª –∑“Ø–π–Ω —Ö—É–≤—å–¥ —ç—Ä“Ø“Ø–ª –±–∞–π–Ω–∞.";
//     }
//     explanation = "–≠–Ω—ç—Ö“Ø“Ø —Ç–µ—Å—Ç –Ω—å –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω –æ–Ω–æ—à–ª–æ–≥–æ–æ –±–∏—à –±”©–≥”©”©–¥ –∑”©–≤—Ö”©–Ω —Ç–∞–Ω—ã —Å—Ç—Ä–µ—Å—Å–∏–π–Ω —Ç“Ø–≤—à–Ω–∏–π —Ç–∞–ª–∞–∞—Ä—Ö ”©”©—Ä–∏–π–≥”©”© “Ø–Ω—ç–ª—ç—Ö—ç–¥ —Ç—É—Å–ª–∞—Ö –∑–æ—Ä–∏–ª–≥–æ—Ç–æ–π —é–º. –•—ç—Ä—ç–≤ —Ç–∞ ”©–Ω–¥”©—Ä –æ–Ω–æ–æ –∞–≤—Å–∞–Ω –±–æ–ª —ç—Å–≤—ç–ª ”©”©—Ä–∏–π–≥”©”© —Å—Ç—Ä–µ—Å—Å—Ç—ç–π –±–∞–π–Ω–∞ –≥—ç–∂ “Ø–∑–≤—ç–ª, –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω —Å—ç—Ç–≥—ç–ª –∑“Ø–π—á, —ç–º—á —ç—Å–≤—ç–ª –∑”©–≤–ª”©—Ö”©”©—Å —Ç—É—Å–ª–∞–º–∂ –∞–≤–∞—Ö –Ω—å —á—É—Ö–∞–ª —é–º.";
//   } else if (testType === "sectionsTest3") {
//     if (score >= 121) {
//       interpretation =
//         "–°—ç—Ç–≥—ç–ª —Ö”©–¥–ª”©–ª”©”© —É–¥–∏—Ä–¥–∞—Ö —á–∞–¥–∞–º–∂ –º–∞—à ”©–Ω–¥”©—Ä. –°—ç—Ç–≥—ç–ª —Ö”©–¥–ª”©–ª”©”© –±“Ø—Ä—ç–Ω —Ö—è–Ω–∞–∂, –±—É—Å–∞–¥—Ç–∞–π “Ø—Ä –¥“Ø–Ω—Ç—ç–π —Ö–∞—Ä–∏–ª—Ü–∞–∂, —Ç—ç–¥–Ω–∏–π–≥ —É—Ä–∞–º—à—É—É–ª–∞–Ω –¥—ç–º–∂–∏—Ö —á–∞–¥–≤–∞—Ä—Ç–∞–π.";
//     } else if (score >= 91 && score <= 120) {
//       interpretation =
//         "–°—ç—Ç–≥—ç–ª —Ö”©–¥–ª”©–ª”©”© —É–¥–∏—Ä–¥–∞—Ö —á–∞–¥–∞–º–∂ —Å–∞–π–Ω. ”®”©—Ä–∏–π–≥”©”© –±–æ–ª–æ–Ω –±—É—Å–¥—ã–≥ –æ–π–ª–≥–æ—Ö, —Ö–∞—Ä–∏–ª—Ü–∞–∞–≥–∞–∞ –∑–æ—Ö–∏—Ü—É—É–ª–∞—Ö —á–∞–¥–≤–∞—Ä—Ç–∞–π.";
//     } else if (score >= 61 && score <= 90) {
//       interpretation =
//         "–°—ç—Ç–≥—ç–ª —Ö”©–¥–ª”©–ª”©”© —É–¥–∏—Ä–¥–∞—Ö —á–∞–¥–∞–º–∂ –¥—É–Ω–¥ –∑—ç—Ä—ç–≥. –ó–∞—Ä–∏–º–¥–∞–∞ —Å—ç—Ç–≥—ç–ª —Ö”©–¥–ª”©–ª”©”© —Ö—è–Ω–∞—Ö, –±—É—Å–∞–¥—Ç–∞–π —Ö–∞—Ä–∏–ª—Ü–∞—Ö–∞–¥ –±—ç—Ä—Ö—à—ç—ç–ª —Ç—É–ª–≥–∞—Ä–¥–∞–≥ –±–∞–π–∂ –±–æ–ª–Ω–æ.";
//     } else {
//       interpretation =
//         "–°—ç—Ç–≥—ç–ª —Ö”©–¥–ª”©–ª”©”© —É–¥–∏—Ä–¥–∞—Ö —á–∞–¥–∞–º–∂ —Ö–∞—Ä—å—Ü–∞–Ω–≥—É–π –¥–æ–æ–≥—É—É—Ä. ”®”©—Ä–∏–π–≥”©”© –±–æ–ª–æ–Ω –±—É—Å–¥—ã–≥ –æ–π–ª–≥–æ—Ö, —Ö–∞—Ä–∏–ª—Ü–∞–∞–≥–∞–∞ —Å–∞–π–∂—Ä—É—É–ª–∞—Ö —Ç–∞–ª –¥—ç—ç—Ä –∞–Ω—Ö–∞–∞—Ä–∞—Ö —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π.";
//     }
//     explanation = "";
//   } else if (testType === "sectionsTest4") {
//     if (score >= 121) {
//       interpretation =
//         "“Æ–Ω—ç–Ω –±–∞–π—Ö —á–∞–¥–≤–∞—Ä –º–∞—à ”©–Ω–¥”©—Ä. –¢–∞ “Ø—Ä–≥—ç–ª–∂ —à—É–¥–∞—Ä–≥–∞, “Ø–Ω—ç–Ω—á, –∑–∞—Ä—á–∏–º—á –±–∞–π–¥–∞–≥. –¢–∞–Ω—ã “Ø–≥, “Ø–π–ª–¥—ç–ª —Ö–æ—ë—Ä “Ø—Ä–≥—ç–ª–∂ —Ö–æ–æ—Ä–æ–Ω–¥–æ–æ —Ç–∞–∞—Ä—á, —Ç–∞–Ω—ã –Ω—ç—Ä —Ö“Ø–Ω–¥ –º–∞—à ”©–Ω–¥”©—Ä –±–∞–π–¥–∞–≥. –¢–∞ –±—É—Å–¥—ã–Ω –∏—Ç–≥—ç–ª–∏–π–≥ –±“Ø—Ä—ç–Ω —Ö“Ø–ª—ç—ç–∂, –Ω–∏–π–≥—ç–º –±–æ–ª–æ–Ω –∞–∂–∏–ª –¥—ç—ç—Ä—ç—ç –º–∞–Ω–ª–∞–π–ª–∞–≥—á –Ω—ç–≥—ç–Ω –±–∞–π–¥–∞–≥.";
//     } else if (score >= 91 && score <= 120) {
//       interpretation =
//         "“Æ–Ω—ç–Ω –±–∞–π—Ö —á–∞–¥–≤–∞—Ä —Å–∞–π–Ω. –¢–∞ –∏—Ö—ç–Ω—Ö —Ç–æ—Ö–∏–æ–ª–¥–æ–ª–¥ —à—É–¥–∞—Ä–≥–∞, “Ø–Ω—ç–Ω—á, –Ω–∞–π–¥–≤–∞—Ä—Ç–∞–π –±–∞–π–¥–∞–≥. –¢–∞–Ω—ã —ë—Å –∑“Ø–π–Ω –∑–∞—Ä—á–º—É—É–¥ —Ç–æ–¥–æ—Ä—Ö–æ–π –±”©–≥”©”©–¥ —Ç–∞ —Ç“Ø“Ø–Ω–∏–π–≥—ç—ç –±–∞—Ä–∏–º—Ç–ª–∞—Ö—ã–≥ —Ö–∏—á—ç—ç–¥—ç–≥. –≠–Ω—ç –Ω—å –±—É—Å–¥—ã–Ω –∏—Ç–≥—ç–ª–∏–π–≥ —Ö“Ø–ª—ç—ç–∂, —ç—Ä–≥—ç–Ω —Ç–æ–π—Ä–æ–Ω–¥ —Ç–∞–Ω—å —ç–µ—Ä—ç–≥ –Ω”©–ª”©”© “Ø–∑“Ø“Ø–ª–¥—ç–≥.";
//     } else if (score >= 61 && score <= 90) {
//       interpretation =
//         "“Æ–Ω—ç–Ω –±–∞–π—Ö —á–∞–¥–≤–∞—Ä –¥—É–Ω–¥ –∑—ç—Ä—ç–≥. –¢–∞ –∏—Ö—ç–Ω—Ö —Ç–æ—Ö–∏–æ–ª–¥–æ–ª–¥ “Ø–Ω—ç–Ω—á –±–∞–π—Ö—ã–≥ —Ö–∏—á—ç—ç–¥—ç–≥ —á, –∑–∞—Ä–∏–º–¥–∞–∞ –¥–∞—Ä–∞–º—Ç —ç—Å–≤—ç–ª –∞—à–∏–≥ —Å–æ–Ω–∏—Ä—Ö–ª—ã–Ω “Ø–µ–¥ –∑–∞—Ä—á–∏–º–¥–∞–∞ “Ø–Ω—ç–Ω—á –±–∞–π–∂ —á–∞–¥–¥–∞–≥–≥“Ø–π –±–∞–π–∂ –º–∞–≥–∞–¥–≥“Ø–π. ”®”©—Ä–∏–π–Ω “Ø–Ω—ç—Ç –∑“Ø–π–ª—Å—ç—ç —Ç–æ–¥–æ—Ä—Ö–æ–π–ª–∂, —Ö“Ø–Ω–¥ –Ω”©—Ö—Ü”©–ª–¥ —á —Ç“Ø“Ø–Ω–¥—ç—ç “Ø–Ω—ç–Ω—á –±–∞–π—Ö—ã–≥ —Ö–∏—á—ç—ç—Ö –Ω—å –∑“Ø–π—Ç—ç–π.";
//     } else {
//       interpretation =
//         "“Æ–Ω—ç–Ω –±–∞–π—Ö —á–∞–¥–≤–∞—Ä —Ö–∞—Ä—å—Ü–∞–Ω–≥—É–π –¥–æ–æ–≥—É—É—Ä. –¢–∞ —à—É–¥–∞—Ä–≥–∞ –±–∞–π–¥–∞–ª, —ë—Å –∑“Ø–π–Ω –∑–∞—Ä—á–º—É—É–¥–∞–∞ –±–∞—Ä–∏–º—Ç–ª–∞—Ö–∞–¥ –±—ç—Ä—Ö—à—ç—ç–ª—Ç—ç–π –±–∞–π–¥–∞–≥. “Æ–Ω—ç–Ω—á –±–∞–π–¥–∞–ª, —Ö–∞—Ä–∏—É—Ü–ª–∞–≥–∞ —Ö“Ø–ª—ç—ç—Ö, –±—É—Å–¥—ã–Ω –∏—Ç–≥—ç–ª–∏–π–≥ —Ö“Ø–Ω–¥–ª—ç—Ö —Ç–∞–ª –¥—ç—ç—Ä –∞–Ω—Ö–∞–∞—Ä–∞—Ö —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π. –≠–Ω—ç –Ω—å —Ç–∞–Ω—ã —Ö—É–≤–∏–π–Ω –±–æ–ª–æ–Ω –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω —Ö–∞—Ä–∏–ª—Ü–∞–∞–Ω–¥ —Å”©—Ä–≥”©”©—Ä –Ω”©–ª”©”©–ª–∂ –±–æ–ª–∑–æ—à–≥“Ø–π.";
//     }
//     explanation = "–≠–Ω—ç—Ö“Ø“Ø —Ç–µ—Å—Ç –Ω—å –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω –æ–Ω–æ—à–ª–æ–≥–æ–æ –±–∏—à –±”©–≥”©”©–¥ –∑”©–≤—Ö”©–Ω —Ç–∞–Ω—ã “Ø–Ω—ç–Ω –±–∞–π—Ö —Ö–∞–Ω–¥–ª–∞–≥—ã–Ω —Ç–∞–ª–∞–∞—Ä—Ö ”©”©—Ä–∏–π–≥”©”© “Ø–Ω—ç–ª—ç—Ö—ç–¥ —Ç—É—Å–ª–∞—Ö –∑–æ—Ä–∏–ª–≥–æ—Ç–æ–π —é–º. “Æ–Ω—ç–Ω –±–∞–π—Ö —á–∞–¥–≤–∞—Ä –Ω—å —Ö—É–≤—å —Ö“Ø–Ω–∏–π –º”©–Ω —á–∞–Ω–∞—Ä –±–æ–ª–æ–≤—á –±–∞–π–Ω–≥–∞ —Å–∞–π–∂—Ä—É—É–ª–∂ –±–æ–ª–æ—Ö —É—Ä —á–∞–¥–≤–∞—Ä —é–º. ";
//   } else if (testType === "sectionsTest5") {
//     if (score >= 121) {
//       interpretation =
//         "”®”©—Ä–∏–π–≥”©”© “Ø–Ω—ç–ª—ç—Ö —á–∞–¥–≤–∞—Ä –º–∞—à ”©–Ω–¥”©—Ä. –¢–∞ ”©”©—Ä–∏–π–≥”©”© –≥“Ø–Ω–∑–≥–∏–π –æ–π–ª–≥–æ–∂, –¥–∞–≤—É—É –±–æ–ª–æ–Ω —Å—É–ª —Ç–∞–ª—É—É–¥–∞–∞ –±–æ–¥–∏—Ç–æ–π–≥–æ–æ—Ä “Ø–Ω—ç–ª–¥—ç–≥. –¢–∞ ”©”©—Ä—Ç”©”© –∏—Ç–≥—ç–ª—Ç—ç–π, —Ö–∞—Ä–∏—É—Ü–ª–∞–≥–∞—Ç–∞–π –±”©–≥”©”©–¥ –∞–ª–¥–∞–∞–Ω–∞–∞—Å–∞–∞ —Å—É—Ä–∞–ª—Ü–∞–Ω, –±–∞–π–Ω–≥–∞ ”©—Å”©–Ω –¥—ç–≤–∂–∏—Ö–∏–π–≥ —ç—Ä–º—ç–ª–∑–¥—ç–≥. –¢–∞–Ω—ã —ç–Ω—ç —á–∞–¥–≤–∞—Ä –Ω—å —Ç–∞–Ω—ã–≥ ”©”©—Ä–∏–π–≥”©”© —É–¥–∏—Ä–¥–∞—Ö, –∑–æ—Ä–∏–ª–≥–æ–¥–æ–æ —Ö“Ø—Ä—ç—Ö, —ç—Ä“Ø“Ø–ª —Ö–∞—Ä–∏–ª—Ü–∞–∞–≥ –±–∏–π –±–æ–ª–≥–æ—Ö–æ–¥ —á—É—Ö–∞–ª “Ø“Ø—Ä—ç–≥ –≥“Ø–π—Ü—ç—Ç–≥—ç–¥—ç–≥.";
//     } else if (score >= 91 && score <= 120) {
//       interpretation =
//         "”®”©—Ä–∏–π–≥”©”© “Ø–Ω—ç–ª—ç—Ö —á–∞–¥–≤–∞—Ä —Å–∞–π–Ω. –¢–∞ ”©”©—Ä–∏–π–Ω –¥–∞–≤—É—É, —Å—É–ª —Ç–∞–ª—ã–≥ –±–æ–¥–∏—Ç–æ–π–≥–æ–æ—Ä “Ø–Ω—ç–ª–∂, ”©”©—Ä–∏–π–≥”©”© —Ö”©–≥–∂“Ø“Ø–ª—ç—Ö–∏–π–Ω —Ç”©–ª”©”© —Ö–∏—á—ç—ç–¥—ç–≥. –¢–∞ –±—É—Å–¥—ã–Ω —à“Ø“Ø–º–∂–ª—ç–ª–∏–π–≥ —Ö“Ø–ª—ç—ç–Ω –∞–≤—á, ”©”©—Ä–∏–π–Ω —à–∏–π–¥–≤—ç—Ä, “Ø–π–ª–¥–ª—ç—ç —ç—Ä–≥—ç—Ü“Ø“Ø–ª—ç–Ω –¥“Ø–≥–Ω—ç–∂ —á–∞–¥–¥–∞–≥. –≠–Ω—ç –Ω—å —Ç–∞–Ω—ã —Ö—É–≤–∏–π–Ω –±–æ–ª–æ–Ω –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω –∞–º—å–¥—Ä–∞–ª–¥ —ç–µ—Ä—ç–≥ –Ω”©–ª”©”© “Ø–∑“Ø“Ø–ª–¥—ç–≥.";
//     } else if (score >= 61 && score <= 90) {
//       interpretation =
//         "”®”©—Ä–∏–π–≥”©”© “Ø–Ω—ç–ª—ç—Ö —á–∞–¥–≤–∞—Ä –¥—É–Ω–¥ –∑—ç—Ä—ç–≥. –¢–∞ ”©”©—Ä–∏–π–Ω—Ö”©”© —Ç–∞–ª–∞–∞—Ä —Ç–æ–¥–æ—Ä—Ö–æ–π –æ–π–ª–≥–æ–ª—Ç—Ç–æ–π —á, –∑–∞—Ä–∏–º–¥–∞–∞ ”©”©—Ä–∏–π–≥”©”© —Ö—ç—Ç ”©–Ω–¥”©—Ä —ç—Å–≤—ç–ª —Ö—ç—Ç –¥–æ–æ–≥—É—É—Ä “Ø–Ω—ç–ª—ç—Ö —Ö–∞–Ω–¥–ª–∞–≥–∞—Ç–∞–π –±–∞–π–∂ –º–∞–≥–∞–¥–≥“Ø–π. –ë—É—Å–¥—ã–Ω —à“Ø“Ø–º–∂–ª—ç–ª–∏–π–≥ —Ö“Ø–ª—ç—ç–Ω –∞–≤–∞—Ö, ”©”©—Ä–∏–π–Ω –º—ç–¥—Ä—ç–º–∂, –±–æ–¥–ª—ã–≥ –≥“Ø–Ω–∑–≥–∏–π—Ä“Ø“Ø–ª—ç–Ω –æ–π–ª–≥–æ—Ö, –∞–ª–¥–∞–∞–Ω–∞–∞—Å–∞–∞ —Å—É—Ä–∞–ª—Ü–∞—Ö–∞–¥ –∞–Ω—Ö–∞–∞—Ä–ª–∞–∞ —Ö–∞–Ω–¥—É—É–ª–∞—Ö –Ω—å –∑“Ø–π—Ç—ç–π.";
//     } else {
//       interpretation =
//         "”®”©—Ä–∏–π–≥”©”© “Ø–Ω—ç–ª—ç—Ö —á–∞–¥–≤–∞—Ä —Ö–∞—Ä—å—Ü–∞–Ω–≥—É–π –¥–æ–æ–≥—É—É—Ä. –¢–∞ ”©”©—Ä–∏–π–Ω –¥–∞–≤—É—É, —Å—É–ª —Ç–∞–ª—ã–≥ —Ç–æ–¥–æ—Ä—Ö–æ–π –º—ç–¥—ç—Ö–≥“Ø–π –±–∞–π—Ö —ç—Å–≤—ç–ª ”©”©—Ä–∏–π–≥”©”© –±–æ–¥–∏—Ç–æ–π–≥–æ–æ—Ä “Ø–Ω—ç–ª—ç—Ö—ç–¥ –±—ç—Ä—Ö—à—ç—ç–ª—Ç—ç–π –±–∞–π–¥–∞–≥. ”®”©—Ä—Ç”©”© –∏—Ç–≥—ç–ª–≥“Ø–π –±–∞–π—Ö, —ç—Å–≤—ç–ª —Ö—ç—Ç –∏—Ö ”©”©—Ä–∏–π–≥”©”© —à“Ø“Ø–º–∂–ª—ç—Ö —Ö–∞–Ω–¥–ª–∞–≥–∞—Ç–∞–π –±–∞–π–∂ –±–æ–ª–Ω–æ. ”®”©—Ä–∏–π–≥”©”© —Ç–∞–Ω–∏—Ö, ”©”©—Ä–∏–π–≥”©”© —Ö“Ø–ª—ç—ç–Ω –∑”©–≤—à”©”©—Ä”©—Ö, –∞–ª–¥–∞–∞–Ω–∞–∞—Å–∞–∞ —Å—É—Ä–∞–ª—Ü–∞—Ö —Ç–∞–ª –¥—ç—ç—Ä –∞–Ω—Ö–∞–∞—Ä–∞—Ö —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π.";
//     }
//     explanation = "–≠–Ω—ç—Ö“Ø“Ø —Ç–µ—Å—Ç –Ω—å –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω –æ–Ω–æ—à–ª–æ–≥–æ–æ –±–∏—à –±”©–≥”©”©–¥ –∑”©–≤—Ö”©–Ω —Ç–∞–Ω—ã ”©”©—Ä–∏–π–≥”©”© “Ø–Ω—ç–ª—ç—Ö —Ö–∞–Ω–¥–ª–∞–≥—ã–Ω —Ç–∞–ª–∞–∞—Ä—Ö ”©”©—Ä–∏–π–≥”©”© “Ø–Ω—ç–ª—ç—Ö—ç–¥ —Ç—É—Å–ª–∞—Ö –∑–æ—Ä–∏–ª–≥–æ—Ç–æ–π —é–º. ”®”©—Ä–∏–π–≥”©”© “Ø–Ω—ç–ª—ç—Ö —á–∞–¥–≤–∞—Ä –±–æ–ª –±–∞–π–Ω–≥–∞ —Ö”©–≥–∂“Ø“Ø–ª–∂ –±–æ–ª–æ—Ö —É—Ä —á–∞–¥–≤–∞—Ä —é–º. ";
//   } else if (testType === "sectionsTest6") {
//     if (score >= 121) {
//       interpretation =
//         "–≠–º–ø–∞—Ç–∏–π–Ω —Ç“Ø–≤—à–∏–Ω –º–∞—à ”©–Ω–¥”©—Ä. –¢–∞ –±—É—Å–¥—ã–Ω –º—ç–¥—Ä—ç–º–∂, –±–æ–¥–æ–ª —Å–∞–Ω–∞–∞–≥ –≥“Ø–Ω –≥“Ø–Ω–∑–≥–∏–π –æ–π–ª–≥–æ–∂, –º—ç–¥—ç—Ä—á —á–∞–¥–¥–∞–≥. –¢–∞–Ω—ã —ç–º–ø–∞—Ç–∏–π–Ω —á–∞–¥–≤–∞—Ä –Ω—å –±—É—Å–∞–¥—Ç–∞–π —Ö“Ø—á—Ç—ç–π —Ö–æ–ª–±–æ–æ —Ç–æ–≥—Ç–æ–æ—Ö, “Ø—Ä –¥“Ø–Ω—Ç—ç–π —Ö–∞—Ä–∏–ª—Ü–∞—Ö, –º”©–Ω —ç—Ä–≥—ç–Ω —Ç–æ–π—Ä–æ–Ω–¥ –±–∞–π–≥–∞–∞ —Ö“Ø–º“Ø“Ø—Å—Ç—ç—ç —ç–µ—Ä—ç–≥ –Ω”©–ª”©”© “Ø–∑“Ø“Ø–ª—ç—Ö—ç–¥ —Ç—É—Å–∞–ª–¥–∞–≥. –¢–∞ –º–∞–≥–∞–¥–≥“Ø–π -—ç–º–ø–∞—Ç–∏–∫ —Ö“Ø–Ω- –≥—ç–∂ –Ω—ç—Ä–ª—ç–≥–¥—ç—Ö –Ω—å –æ–ª–æ–Ω—Ç–∞–∞.";
//     } else if (score >= 91 && score <= 120) {
//       interpretation =
//         "–≠–º–ø–∞—Ç–∏–π–Ω —Ç“Ø–≤—à–∏–Ω —Å–∞–π–Ω. –¢–∞ –∏—Ö—ç–Ω—Ö —Ç–æ—Ö–∏–æ–ª–¥–æ–ª–¥ –±—É—Å–¥—ã–Ω –º—ç–¥—Ä—ç–º–∂, –±–æ–¥–æ–ª —Å–∞–Ω–∞–∞–≥ –æ–π–ª–≥–æ–∂, —Ç—ç–¥—ç–Ω–¥ —Ç—É—Å–ª–∞—Ö—ã–≥ —Ö–∏—á—ç—ç–¥—ç–≥. –¢–∞–Ω—ã —ç–º–ø–∞—Ç–∏–π–Ω —á–∞–¥–≤–∞—Ä –Ω—å —Ö–∞—Ä–∏–ª—Ü–∞–∞ –±–æ–ª–æ–Ω –Ω–∏–π–≥–º–∏–π–Ω –∞–º—å–¥—Ä–∞–ª–¥ —Ç–∞–Ω—å —ç–µ—Ä–≥—ç—ç—Ä –Ω”©–ª”©”©–ª–¥”©–≥.";
//     } else if (score >= 61 && score <= 90) {
//       interpretation =
//         "–≠–º–ø–∞—Ç–∏–π–Ω —Ç“Ø–≤—à–∏–Ω –¥—É–Ω–¥ –∑—ç—Ä—ç–≥. –¢–∞ –∑–∞—Ä–∏–º–¥–∞–∞ –±—É—Å–¥—ã–Ω –º—ç–¥—Ä—ç–º–∂–∏–π–≥ –æ–π–ª–≥–æ–¥–æ–≥ —á, –±“Ø—Ä—ç–Ω –¥“Ø“Ø—Ä—ç–Ω –º—ç–¥—ç—Ä—á, —Ö–∞—Ä–∏—É “Ø–π–ª–¥—ç–ª “Ø–∑“Ø“Ø–ª–∂ —á–∞–¥–¥–∞–≥–≥“Ø–π –±–∞–π–∂ –º–∞–≥–∞–¥–≥“Ø–π. –ò–¥—ç–≤—Ö—Ç—ç–π —Å–æ–Ω—Å–æ—Ö, ”©”©—Ä–∏–π–≥”©”© –±—É—Å–¥—ã–Ω –æ—Ä–æ–Ω–¥ —Ç–∞–≤–∏—Ö –¥–∞—Å–≥–∞–ª—É—É–¥ —Ö–∏–π—Ö –Ω—å –∑“Ø–π—Ç—ç–π.";
//     } else {
//       interpretation =
//         "–≠–º–ø–∞—Ç–∏–π–Ω —Ç“Ø–≤—à–∏–Ω —Ö–∞—Ä—å—Ü–∞–Ω–≥—É–π –¥–æ–æ–≥—É—É—Ä. –¢–∞ –±—É—Å–¥—ã–Ω –º—ç–¥—Ä—ç–º–∂, —Ö—ç—Ä—ç–≥—Ü—ç—ç–≥ –æ–π–ª–≥–æ—Ö–æ–¥ –±—ç—Ä—Ö—à—ç—ç–ª—Ç—ç–π –±–∞–π–∂ –±–æ–ª–Ω–æ. –•–∞—Ä–∏–ª—Ü–∞–∞, –±—É—Å–¥—ã–≥ –æ–π–ª–≥–æ—Ö —á–∞–¥–≤–∞—Ä–∞–∞ —Ö”©–≥–∂“Ø“Ø–ª—ç—Ö—ç–¥ –∏–ª“Ø“Ø –∞–Ω—Ö–∞–∞—Ä–∞—Ö —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π.";
//     }
//     explanation = "–≠–Ω—ç—Ö“Ø“Ø —Ç–µ—Å—Ç –Ω—å –º—ç—Ä–≥—ç–∂–ª–∏–π–Ω –æ–Ω–æ—à–ª–æ–≥–æ–æ –±–∏—à –±”©–≥”©”©–¥ –∑”©–≤—Ö”©–Ω —Ç–∞–Ω—ã —ç–º–ø–∞—Ç–∏–π–Ω —Ç“Ø–≤—à–Ω–∏–π —Ç–∞–ª–∞–∞—Ä—Ö ”©”©—Ä–∏–π–≥”©”© “Ø–Ω—ç–ª—ç—Ö—ç–¥ —Ç—É—Å–ª–∞—Ö –∑–æ—Ä–∏–ª–≥–æ—Ç–æ–π —é–º. –≠–º–ø–∞—Ç–∏ –±–æ–ª –±–∞–π–Ω–≥–∞ —Ö”©–≥–∂“Ø“Ø–ª–∂ –±–æ–ª–æ—Ö —É—Ä —á–∞–¥–≤–∞—Ä —é–º. ";
//   } else if (testType === "sectionsTest7") {
//     if (score >= 121) {
//       interpretation =
//         "–®“Ø“Ø–º–∂–ª—ç–ª—Ç —Å—ç—Ç–≥—ç–ª–≥—ç—ç –º–∞—à ”©–Ω–¥”©—Ä. –¢–∞ –∞–ª–∏–≤–∞–∞ –º—ç–¥—ç—ç–ª—ç–ª–¥ —à“Ø“Ø–º–∂–ª—ç–ª—Ç—ç–π —Ö–∞–Ω–¥–∞–∂, –Ω–∞—Ä–∏–π–Ω —Ç”©–≤”©–≥—Ç—ç–π –∞—Å—É—É–¥–ª—ã–≥ —á –∞–º–∂–∏–ª—Ç—Ç–∞–π —à–∏–π–¥–≤—ç—Ä–ª—ç—Ö —á–∞–¥–≤–∞—Ä—Ç–∞–π.";
//     } else if (score >= 91 && score <= 120) {
//       interpretation =
//         "–®“Ø“Ø–º–∂–ª—ç–ª—Ç —Å—ç—Ç–≥—ç–ª–≥—ç—ç —Å–∞–π–Ω. –¢–∞ –∏—Ö—ç–Ω—Ö —Ç–æ—Ö–∏–æ–ª–¥–æ–ª–¥ –º—ç–¥—ç—ç–ª–ª–∏–π–≥ “Ø–Ω—ç–ª–∂, –ª–æ–≥–∏–∫ “Ø–Ω–¥—ç—Å–ª—ç–ª—Ç—ç–π –¥“Ø–≥–Ω—ç–ª—Ç –≥–∞—Ä–≥–∞–∂ —á–∞–¥–¥–∞–≥.";
//     } else if (score >= 61 && score <= 90) {
//       interpretation =
//         "–®“Ø“Ø–º–∂–ª—ç–ª—Ç —Å—ç—Ç–≥—ç–ª–≥—ç—ç –¥—É–Ω–¥ –∑—ç—Ä—ç–≥. –ó–∞—Ä–∏–º–¥–∞–∞ –∞—Å—É—É–¥–ª—ã–≥ –≥“Ø–Ω–∑–≥–∏–π—Ä“Ø“Ø–ª—ç–Ω —Å—É–¥–ª–∞—Ö, –ª–æ–≥–∏–∫ –∞–ª–¥–∞–∞–≥ –æ–ª–æ—Ö–æ–¥ –±—ç—Ä—Ö—à—ç—ç–ª —Ç—É–ª–≥–∞—Ä–¥–∞–≥ –±–∞–π–∂ –±–æ–ª–Ω–æ.";
//     } else {
//       interpretation =
//         "–®“Ø“Ø–º–∂–ª—ç–ª—Ç —Å—ç—Ç–≥—ç–ª–≥—ç—ç —Ö–∞—Ä—å—Ü–∞–Ω–≥—É–π –¥–æ–æ–≥—É—É—Ä. –ú—ç–¥—ç—ç–ª—ç–ª–¥ –¥“Ø–Ω —à–∏–Ω–∂–∏–ª–≥—ç—ç —Ö–∏–π—Ö, “Ø–Ω–¥—ç—Å–ª—ç–ª—Ç—ç–π –¥“Ø–≥–Ω—ç–ª—Ç –≥–∞—Ä–≥–∞—Ö —Ç–∞–ª –¥—ç—ç—Ä –∞–Ω—Ö–∞–∞—Ä–∞—Ö —à–∞–∞—Ä–¥–ª–∞–≥–∞—Ç–∞–π.";
//     }
//     explanation = "";
//   } 

//   const subject = `${testType} ‚Äî –¢–∞–Ω—ã “Ø—Ä –¥“Ø–Ω üéâ`;
//   const text = `–°–∞–π–Ω –±–∞–π–Ω–∞ —É—É!\n\n"${testType}" —Ç–µ—Å—Ç–∏–π–Ω —Ç–∞–Ω—ã –æ–Ω–æ–æ: ${score}/150\n\n${interpretation}\n\n${explanation}INNER.mn –±–∞–≥`;

//   try {
//     await mg.messages.create(process.env.MAILGUN_DOMAIN, {
//       from: `INNER <postmaster@${process.env.MAILGUN_DOMAIN}>`,
//       to: [email],
//       subject,
//       text,
//     });

//     console.log(`‚úÖ Email sent to ${email} for ${testType}`);
//     res.json({ success: true });
//   } catch (err) {
//     console.error("‚ùå Error sending email:", err);
//     res.status(500).json({ success: false, message: "Failed to send email" });
//   }
// });

// ---------------------------
// Start server
// ---------------------------
const PORT = process.env.PORT || 3000;
app.listen(PORT, "0.0.0.0", () => {
  console.log(`üöÄ Server running on http://0.0.0.0:${PORT}`);
});
















