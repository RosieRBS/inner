import express from "express";
import dotenv from "dotenv";
import cors from "cors";
import path from "path";
import { fileURLToPath } from "url";
import formData from "form-data";
import Mailgun from "mailgun.js";
import fetch from "node-fetch";// âœ… needed for QPay API calls
import bodyParser from "body-parser";
import fs from "fs";
// ---------------------------
// Setup
// ---------------------------
dotenv.config();
const app = express();
app.use(cors());
app.use(express.json());

// For ES modules
const __filename = fileURLToPath(import.meta.url);
const __dirname = path.dirname(__filename);

// Serve front-end files
app.use(express.static(path.join(__dirname)));

// ---------------------------
// Email transporter (Mailgun)
// ---------------------------
const mailgun = new Mailgun(formData);
const mg = mailgun.client({
  username: "api",
  key: process.env.MAILGUN_API_KEY,
  url: "https://api.eu.mailgun.net",
});

// ---------------------------
// ðŸ”¹ QPay Integration
// ---------------------------
// ===============
// QPAY TOKEN FUNCTION
// ===============
async function getQPayToken() {
  try {
    const basicAuth = Buffer.from(
      `${process.env.QPAY_USERNAME}:${process.env.QPAY_PASSWORD}`
    ).toString("base64");

    const response = await fetch(`${process.env.QPAY_BASE_URL}/v2/auth/token`, {
      method: "POST",
      headers: {
        Authorization: `Basic ${basicAuth}`,
        "Content-Type": "application/json",
      },
    });

    const data = await response.json();

    if (!response.ok || !data.access_token) {
      console.error("âŒ QPay Auth Error:", data);
      throw new Error(data.error || "Failed to get QPay token");
    }

    return data.access_token;
  } catch (err) {
    console.error("âŒ QPay token error:", err.message, err.stack);
    throw err;
  }
}

// ===============
// CREATE INVOICE
// ===============
app.post("/create-invoice", async (req, res) => {
  const { amount, email, testType } = req.body;

  try {
    const token = await getQPayToken();

    const invoicePayload = {
      invoice_code: process.env.QPAY_INVOICE_CODE,
      sender_invoice_no: `INV-${Date.now()}`,
      invoice_receiver_code: `USER-${Date.now()}`,
      invoice_description: testType || "Test Payment",
      amount: amount || 1000,
    };

    const invoiceRes = await fetch(`${process.env.QPAY_BASE_URL}/v2/invoice`, {
      method: "POST",
      headers: {
        Authorization: `Bearer ${token}`,
        "Content-Type": "application/json",
      },
      body: JSON.stringify(invoicePayload),
    });

    const invoiceData = await invoiceRes.json();

    if (!invoiceRes.ok) {
      console.error("âŒ QPay invoice error:", invoiceData);
      return res.status(500).json({ error: "Failed to create invoice" });
    }

    const qrBase64 = invoiceData.qr_image;
    res.json({
      qr_base64: qrBase64,
      invoice_id: invoiceData.invoice_id,
    });
  } catch (err) {
    console.error("âŒ Create invoice failed:", err.message);
    res.status(500).json({ error: "Invoice creation failed" });
  }
});

// ===============
// CHECK INVOICE
// ===============
app.get("/check-invoice/:id", async (req, res) => {
  const { id } = req.params;

  try {
    const token = await getQPayToken();

    const checkRes = await fetch(
      `${process.env.QPAY_BASE_URL}/v2/payment/check/${id}`,
      {
        method: "GET",
        headers: { Authorization: `Bearer ${token}` },
      }
    );

    const checkData = await checkRes.json();

    if (!checkRes.ok) {
      console.error("âŒ QPay check error:", checkData);
      return res.status(500).json({ error: "Failed to check invoice" });
    }

    res.json(checkData);
  } catch (err) {
    console.error("âŒ Check invoice failed:", err.message);
    res.status(500).json({ error: "Check invoice failed" });
  }
});

// ---------------------------
// Existing: POST /send-results
// ---------------------------
app.post("/send-results", async (req, res) => {
  const { email, score, testType } = req.body;
  let interpretation = "";
  let explanation = "";

  if (!email || (!score && score !== 0) || !testType) {
    return res.status(400).json({ success: false, message: "Invalid input" });
  }

  // Interpret result
  if (testType === "sectionsTest1") {
    if (score >= 121) {
      interpretation =
        "Ð¢Ð°Ð½Ñ‹ Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð°Ð½Ð´ Ñ‚Ð¾ÐºÑÐ¸Ðº Ð·Ð°Ð½ Ñ‚Ó©Ð»Ó©Ð² Ð¼Ð°Ñˆ Ñ‚Ð¾Ð´ Ð¸Ð»ÑÑ€Ñ‡ Ð±Ð°Ð¹Ð½Ð°. Ð¥ÑÐ½Ð°Ð»Ñ‚ Ñ‚Ð°Ð²Ð¸Ñ…, Ð±ÑƒÑÐ´Ñ‹Ð³ Ð¼Ð°Ð½Ð¸Ð¿ÑƒÐ»ÑÑ†Ð¸ Ñ…Ð¸Ð¹Ñ…, Ð±Ð°Ð¹Ð½Ð³Ð° Ð±ÑƒÑ€ÑƒÑƒÑ‚Ð³Ð°Ñ…, ÑƒÑƒÑ€ Ð±ÑƒÑ…Ð¸Ð¼Ð´Ð°Ð»Ñ‚Ð°Ð¹ Ð±Ð°Ð¹Ñ… Ð·ÑÑ€ÑÐ³ Ð½ÑŒ Ñ‚Ð°Ð½Ñ‹ Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð°Ð³ Ð½Ð¾Ñ†Ñ‚Ð¾Ð¹Ð³Ð¾Ð¾Ñ€ Ñ…Ð¾Ñ€Ð´ÑƒÑƒÐ»Ð¶ Ð±Ð°Ð¹Ð½Ð°. Ð­Ð½Ñ Ð½ÑŒ Ñ‚Ð°Ð½Ñ‹ Ñ…ÑƒÐ²Ð¸Ð¹Ð½ Ð°Ð¼ÑŒÐ´Ñ€Ð°Ð» Ð±Ð¾Ð»Ð¾Ð½ Ð¾Ð¹Ñ€ Ð´Ð¾Ñ‚Ð½Ñ‹ Ñ…Ò¯Ð¼Ò¯Ò¯ÑÑ‚ Ñ‚Ð°Ð½ÑŒ ÑÓ©Ñ€Ð³Ó©Ó©Ñ€ Ð½Ó©Ð»Ó©Ó©Ð»Ð¶ Ð±Ð°Ð¹Ð³Ð°Ð° Ñ‚ÑƒÐ» Ð¼ÑÑ€Ð³ÑÐ¶Ð»Ð¸Ð¹Ð½ ÑÑÑ‚Ð³ÑÐ» Ð·Ò¯Ð¹Ñ‡Ð¸Ð¹Ð½ Ñ‚ÑƒÑÐ»Ð°Ð¼Ð¶ Ð°Ð²Ð°Ñ…Ñ‹Ð³ Ð·Ó©Ð²Ð»Ó©Ð¶ Ð±Ð°Ð¹Ð½Ð°.";
    } else if (score >= 91 && score <= 120) {
      interpretation =
        "Ð¢Ð°Ð½Ñ‹ Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð°Ð½Ð´ Ñ‚Ð¾ÐºÑÐ¸Ðº Ð·Ð°Ð½ Ñ‚Ó©Ð»Ó©Ð²Ð¸Ð¹Ð½ ÑˆÐ¸Ð½Ð¶ Ñ‚ÑÐ¼Ð´ÑÐ³ Ð½ÑÐ»ÑÑÐ´ Ð¸Ñ… Ð±Ð°Ð¹Ð½Ð°. Ð‘ÑƒÑÐ´Ñ‹Ð³ ÑƒÐ´Ð¸Ñ€Ð´Ð°Ñ…, ÑˆÒ¯Ò¯Ð¼Ð¶Ð»ÑÑ…, ÑÑÑ‚Ð³ÑÐ» ÑÐ°Ð½Ð°Ð°Ð½Ñ‹ Ñ…ÑƒÐ²ÑŒÐ´ Ð´Ð°Ñ€Ð°Ð¼Ñ‚Ð»Ð°Ñ…, Ñ…Ð°Ñ€Ð¸ÑƒÑ†Ð»Ð°Ð³Ð°Ð°Ñ Ð·Ð°Ð¹Ð»ÑÑ…Ð¸Ð¹Ñ… Ð·ÑÑ€ÑÐ³ Ð°ÑÑƒÑƒÐ´Ð»ÑƒÑƒÐ´ Ð³Ð°Ñ€Ñ‡ Ð±Ð¾Ð»Ð·Ð¾ÑˆÐ³Ò¯Ð¹. Ð­Ð´Ð³ÑÑÑ€ Ð·Ð°Ð½ Ñ‚Ó©Ð»Ó©Ð² Ð½ÑŒ Ñ‚Ð°Ð½Ñ‹ Ñ…ÑƒÐ²Ð¸Ð¹Ð½ Ð±Ð¾Ð»Ð¾Ð½ Ð±ÑƒÑÐ´Ñ‹Ð½ Ð°Ð¼ÑŒÐ´Ñ€Ð°Ð»Ð´ ÑÓ©Ñ€Ð³Ó©Ó©Ñ€ Ð½Ó©Ð»Ó©Ó©Ð»Ð¶ Ð±Ð°Ð¹Ð½Ð°.";
    } else if (score >= 61 && score <= 90) {
      interpretation =
        "Ð¢Ð°Ð½Ñ‹ Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð°Ð½Ð´ Ñ‚Ð¾ÐºÑÐ¸Ðº Ð·Ð°Ð½ Ñ‚Ó©Ð»Ó©Ð²Ð¸Ð¹Ð½ Ð·Ð°Ñ€Ð¸Ð¼ ÑˆÐ¸Ð½Ð¶ Ñ‚ÑÐ¼Ð´ÑÐ³ Ð°Ð¶Ð¸Ð³Ð»Ð°Ð³Ð´Ð°Ð¶ Ð¼Ð°Ð³Ð°Ð´Ð³Ò¯Ð¹. Ð—Ð°Ñ€Ð¸Ð¼Ð´Ð°Ð° Ñ…ÑÐ½Ð°Ñ…, ÑˆÒ¯Ò¯Ð¼Ð¶Ð»ÑÑ…, ÑÑÐ²ÑÐ» Ð±ÑƒÑÐ´Ñ‹Ð½ Ð¼ÑÐ´Ñ€ÑÐ¼Ð¶Ð¸Ð¹Ð³ Ò¯Ð» Ñ‚Ð¾Ð¾Ð¼ÑÐ¾Ñ€Ð»Ð¾Ñ… Ð·ÑÑ€ÑÐ³ Ð±Ð°Ð¹Ð´Ð°Ð» Ð¸Ð»ÑÑ€Ñ‡ Ð±Ð¾Ð»Ð½Ð¾. Ó¨Ó©Ñ€Ð¸Ð¹Ð½ Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð°Ð½Ñ‹ Ñ…ÑÐ² Ð¼Ð°ÑÐ³Ð¸Ð¹Ð³ ÑÐ°Ð¹Ð¶Ñ€ÑƒÑƒÐ»Ð°Ñ…Ð°Ð´ Ð°Ð½Ñ…Ð°Ð°Ñ€Ð²Ð°Ð» Ð·Ð¾Ñ…Ð¸Ð½Ð¾.";
    } else {
      interpretation =
        "Ð¢Ð°Ð½Ñ‹ Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð°Ð½Ð´ Ñ‚Ð¾ÐºÑÐ¸Ðº Ð·Ð°Ð½ Ñ‚Ó©Ð»Ó©Ð²Ð¸Ð¹Ð½ ÑˆÐ¸Ð½Ð¶ Ñ‚ÑÐ¼Ð´ÑÐ³ Ð¼Ð°Ñˆ Ð±Ð°Ð³Ð° ÑÑÐ²ÑÐ» Ð¾Ð³Ñ‚ Ð±Ð°Ð¹Ñ…Ð³Ò¯Ð¹. Ð¢Ð° Ð±ÑƒÑÐ°Ð´Ñ‚Ð°Ð¹ ÑÑ€Ò¯Ò¯Ð», ÑÐµÑ€ÑÐ³ Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð°Ð³ Ð±Ð¸Ð¹ Ð±Ð¾Ð»Ð³Ð¾Ñ…Ñ‹Ð³ ÑÑ€Ð¼ÑÐ»Ð·Ð´ÑÐ³.";
    }
    explanation = "Ð­Ð½ÑÑ…Ò¯Ò¯ Ñ‚ÐµÑÑ‚ Ð½ÑŒ Ð¼ÑÑ€Ð³ÑÐ¶Ð»Ð¸Ð¹Ð½ Ð¾Ð½Ð¾ÑˆÐ»Ð¾Ð³Ð¾Ð¾ Ð±Ð¸Ñˆ Ð±Ó©Ð³Ó©Ó©Ð´ Ð·Ó©Ð²Ñ…Ó©Ð½ Ñ‚Ð°Ð½Ñ‹ Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð°Ð½Ñ‹ Ñ…ÑÐ² Ð¼Ð°ÑÐ³Ð¸Ð¹Ð½ Ñ‚Ð°Ð»Ð°Ð°Ñ€Ñ… Ó©Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ò¯Ð½ÑÐ»ÑÑ…ÑÐ´ Ñ‚ÑƒÑÐ»Ð°Ñ… Ð·Ð¾Ñ€Ð¸Ð»Ð³Ð¾Ñ‚Ð¾Ð¹ ÑŽÐ¼. Ð¥ÑÑ€ÑÐ² Ñ‚Ð° Ó©Ó©Ñ€Ð¸Ð¹Ð½ ÑÑÐ²ÑÐ» Ð±ÑƒÑÐ´Ñ‹Ð½ Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð°Ð½ Ð´Ð°Ñ…ÑŒ Ñ‚Ð¾ÐºÑÐ¸Ðº Ð·Ð°Ð½ Ñ‚Ó©Ð»Ó©Ð²Ð¸Ð¹Ð½ Ñ‚Ð°Ð»Ð°Ð°Ñ€ ÑÐ°Ð½Ð°Ð° Ð·Ð¾Ð²Ð¶ Ð±Ð°Ð¹Ð³Ð°Ð° Ð±Ð¾Ð» Ð¼ÑÑ€Ð³ÑÐ¶Ð»Ð¸Ð¹Ð½ ÑÑÑ‚Ð³ÑÐ» Ð·Ò¯Ð¹Ñ‡ ÑÑÐ²ÑÐ» Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð°Ð½Ñ‹ Ð·Ó©Ð²Ð»Ó©Ñ…Ó©Ó©Ñ Ñ‚ÑƒÑÐ»Ð°Ð¼Ð¶ Ð°Ð²Ð°Ñ… Ð½ÑŒ Ñ‡ÑƒÑ…Ð°Ð». Ó¨Ó©Ñ€Ð¸Ð¹Ð½ Ð·Ð°Ð½ Ñ‚Ó©Ð»Ó©Ð²Ð¸Ð¹Ð³ Ó©Ó©Ñ€Ñ‡Ð»Ó©Ñ… Ð½ÑŒ ÑÑ…Ð»ÑÑÐ´ Ó©Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ñ‚Ð°Ð½Ð¸Ñ…Ð°Ð°Ñ ÑÑ…ÑÐ»Ð´ÑÐ³.";
  } else if (testType === "sectionsTest2") {
    if (score >= 121) {
      interpretation =
        "Ð¡Ñ‚Ñ€ÐµÑÑÐ¸Ð¹Ð½ Ñ‚Ò¯Ð²ÑˆÐ¸Ð½ Ð¼Ð°Ñˆ Ó©Ð½Ð´Ó©Ñ€. Ð¢Ð° Ñ…Ò¯Ð½Ð´ Ñ…ÑÐ»Ð±ÑÑ€Ð¸Ð¹Ð½ ÑÑ‚Ñ€ÐµÑÑÑ‚ Ó©Ñ€Ñ‚ÑÓ©Ð½ Ð±Ð°Ð¹Ð¶ Ð±Ð¾Ð»Ð·Ð¾ÑˆÐ³Ò¯Ð¹ Ð±Ó©Ð³Ó©Ó©Ð´ Ð¾Ð»Ð¾Ð½ Ñ‚Ð¾Ð¾Ð½Ñ‹ ÑÑÑ‚Ð³ÑÐ» Ð·Ò¯Ð¹Ð½, Ð±Ð¸Ðµ Ð¼Ð°Ñ…Ð±Ð¾Ð´Ð¸Ð¹Ð½, Ð·Ð°Ð½ Ñ‚Ó©Ð»Ó©Ð²Ð¸Ð¹Ð½ ÑˆÐ¸Ð½Ð¶ Ñ‚ÑÐ¼Ð´Ð³Ò¯Ò¯Ð´ Ð¸Ð»ÑÑ€Ñ‡ Ð±Ð°Ð¹Ð½Ð°. Ð­Ð½Ñ Ð½ÑŒ Ñ‚Ð°Ð½Ñ‹ ÑÑ€Ò¯Ò¯Ð» Ð¼ÑÐ½Ð´ÑÐ´ Ð½Ð¾Ñ†Ñ‚Ð¾Ð¹ Ð°ÑŽÑƒÐ» ÑƒÑ‡Ñ€ÑƒÑƒÐ»Ð¶ Ð±Ð¾Ð»Ð·Ð¾ÑˆÐ³Ò¯Ð¹ Ñ‚ÑƒÐ» ÑÐ°Ñ€Ð°Ð»Ñ‚Ð°Ð¹ Ð¼ÑÑ€Ð³ÑÐ¶Ð»Ð¸Ð¹Ð½ ÑÑÑ‚Ð³ÑÐ» Ð·Ò¯Ð¹Ñ‡ ÑÑÐ²ÑÐ» ÑÐ¼Ñ‡Ð¸Ð´ Ñ…Ð°Ð½Ð´Ð°Ð¶, Ñ‚ÑƒÑÐ»Ð°Ð¼Ð¶ Ð°Ð²Ð°Ñ…Ñ‹Ð³ Ð·Ó©Ð²Ð»Ó©Ð¶ Ð±Ð°Ð¹Ð½Ð°. Ð¯Ð»Ð°Ð½Ð³ÑƒÑÐ° 30-Ñ€ Ð°ÑÑƒÑƒÐ»Ñ‚Ð°Ð´ Ó©Ð½Ð´Ó©Ñ€ Ð¾Ð½Ð¾Ð¾ Ó©Ð³ÑÓ©Ð½ Ð±Ð¾Ð» Ð½ÑÐ½ Ð´Ð°Ñ€ÑƒÐ¹ Ð¼ÑÑ€Ð³ÑÐ¶Ð»Ð¸Ð¹Ð½ Ñ‚ÑƒÑÐ»Ð°Ð¼Ð¶ Ð°Ð²Ð°Ð°Ñ€Ð°Ð¹.";
    } else if (score >= 91 && score <= 120) {
      interpretation =
        "Ð¡Ñ‚Ñ€ÐµÑÑÐ¸Ð¹Ð½ Ñ‚Ò¯Ð²ÑˆÐ¸Ð½ Ð½ÑÐ»ÑÑÐ´ Ó©Ð½Ð´Ó©Ñ€. Ð¢Ð° Ð±Ð°Ð¹Ð½Ð³Ð° ÑÑ‚Ñ€ÐµÑÑÐ¸Ð¹Ð½ ÑˆÐ¸Ð½Ð¶ Ñ‚ÑÐ¼Ð´Ð³Ò¯Ò¯Ð´Ð¸Ð¹Ð³ Ð¼ÑÐ´ÑÑ€Ñ‡, ÑÐ½Ñ Ð½ÑŒ Ñ‚Ð°Ð½Ñ‹ ÑÑÑ‚Ð³ÑÐ» Ð·Ò¯Ð¹Ð½ Ð±Ð¾Ð»Ð¾Ð½ Ð±Ð¸Ðµ Ð¼Ð°Ñ…Ð±Ð¾Ð´Ð¸Ð¹Ð½ ÑÑ€Ò¯Ò¯Ð» Ð¼ÑÐ½Ð´, Ð°Ð¶Ð»Ñ‹Ð½ Ð³Ò¯Ð¹Ñ†ÑÑ‚Ð³ÑÐ», Ñ…ÑƒÐ²Ð¸Ð¹Ð½ Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð°Ð½Ð´ ÑÓ©Ñ€Ð³Ó©Ó©Ñ€ Ð½Ó©Ð»Ó©Ó©Ð»Ð¶ Ð±Ð°Ð¹Ð½Ð°. Ð¡Ñ‚Ñ€ÐµÑÑÑÑ ÑƒÐ´Ð¸Ñ€Ð´Ð°Ñ… Ð°Ñ€Ð³Ð° Ð±Ð°Ñ€Ð¸Ð» ÑÐ·ÑÐ¼ÑˆÐ¸Ð¶, ÑˆÐ°Ð°Ñ€Ð´Ð»Ð°Ð³Ð°Ñ‚Ð°Ð¹ Ð±Ð¾Ð» Ð¼ÑÑ€Ð³ÑÐ¶Ð»Ð¸Ð¹Ð½ Ñ‚ÑƒÑÐ»Ð°Ð¼Ð¶ Ð°Ð²Ð°Ñ… Ñ‚Ð°Ð»Ð°Ð°Ñ€ Ð±Ð¾Ð´Ð¾Ñ… Ñ†Ð°Ð³ Ð±Ð¾Ð»Ð¶ÑÑ.";
    } else if (score >= 61 && score <= 90) {
      interpretation =
        "Ð¡Ñ‚Ñ€ÐµÑÑÐ¸Ð¹Ð½ Ñ‚Ò¯Ð²ÑˆÐ¸Ð½ Ð´ÑƒÐ½Ð´ Ð·ÑÑ€ÑÐ³. Ð¢Ð° Ð·Ð°Ñ€Ð¸Ð¼Ð´Ð°Ð° ÑÑ‚Ñ€ÐµÑÑÐ¸Ð¹Ð½ ÑˆÐ¸Ð½Ð¶ Ñ‚ÑÐ¼Ð´Ð³Ò¯Ò¯Ð´Ð¸Ð¹Ð³ Ð¼ÑÐ´ÑÑ€Ð´ÑÐ³ Ñ‡, ÑÐ½Ñ Ð½ÑŒ Ñ‚Ð°Ð½Ñ‹ Ó©Ð´Ó©Ñ€ Ñ‚ÑƒÑ‚Ð¼Ñ‹Ð½ Ð°Ð¼ÑŒÐ´Ñ€Ð°Ð»Ð´ Ð¸Ñ…ÑÑÑ…ÑÐ½ Ð½Ó©Ð»Ó©Ó©Ð»Ó©Ñ…Ð³Ò¯Ð¹ Ð±Ð°Ð¹Ð½Ð°. Ð¡Ñ‚Ñ€ÐµÑÑÑÑ ÑƒÐ´Ð¸Ñ€Ð´Ð°Ñ… Ð°Ñ€Ð³Ð° Ð±Ð°Ñ€Ð¸Ð»Ð°Ð° ÑÐ°Ð¹Ð¶Ñ€ÑƒÑƒÐ»Ð°Ñ… Ñ‚Ð°Ð»Ð°Ð°Ñ€ Ð±Ð¾Ð´Ð¾Ñ… Ð½ÑŒ Ð·Ò¯Ð¹Ñ‚ÑÐ¹.";
    } else {
      interpretation =
        "Ð¡Ñ‚Ñ€ÐµÑÑÐ¸Ð¹Ð½ Ñ‚Ò¯Ð²ÑˆÐ¸Ð½ Ð¼Ð°Ñˆ Ð±Ð°Ð³Ð° ÑÑÐ²ÑÐ» Ð¾Ð³Ñ‚ Ð±Ð°Ð¹Ñ…Ð³Ò¯Ð¹. Ð¢Ð° ÑÑ‚Ñ€ÐµÑÑÑ‚ÑÐ¹ Ð½Ó©Ñ…Ñ†Ó©Ð» Ð±Ð°Ð¹Ð´Ð°Ð»Ð´ ÑÐ°Ð¹Ð½ Ð´Ð°ÑÐ°Ð½ Ð·Ð¾Ñ…Ð¸Ñ†Ð¾Ð¶, ÑÑÑ‚Ð³ÑÐ» Ð·Ò¯Ð¹Ð½ Ñ…ÑƒÐ²ÑŒÐ´ ÑÑ€Ò¯Ò¯Ð» Ð±Ð°Ð¹Ð½Ð°.";
    }
    explanation = "Ð­Ð½ÑÑ…Ò¯Ò¯ Ñ‚ÐµÑÑ‚ Ð½ÑŒ Ð¼ÑÑ€Ð³ÑÐ¶Ð»Ð¸Ð¹Ð½ Ð¾Ð½Ð¾ÑˆÐ»Ð¾Ð³Ð¾Ð¾ Ð±Ð¸Ñˆ Ð±Ó©Ð³Ó©Ó©Ð´ Ð·Ó©Ð²Ñ…Ó©Ð½ Ñ‚Ð°Ð½Ñ‹ ÑÑ‚Ñ€ÐµÑÑÐ¸Ð¹Ð½ Ñ‚Ò¯Ð²ÑˆÐ½Ð¸Ð¹ Ñ‚Ð°Ð»Ð°Ð°Ñ€Ñ… Ó©Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ò¯Ð½ÑÐ»ÑÑ…ÑÐ´ Ñ‚ÑƒÑÐ»Ð°Ñ… Ð·Ð¾Ñ€Ð¸Ð»Ð³Ð¾Ñ‚Ð¾Ð¹ ÑŽÐ¼. Ð¥ÑÑ€ÑÐ² Ñ‚Ð° Ó©Ð½Ð´Ó©Ñ€ Ð¾Ð½Ð¾Ð¾ Ð°Ð²ÑÐ°Ð½ Ð±Ð¾Ð» ÑÑÐ²ÑÐ» Ó©Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© ÑÑ‚Ñ€ÐµÑÑÑ‚ÑÐ¹ Ð±Ð°Ð¹Ð½Ð° Ð³ÑÐ¶ Ò¯Ð·Ð²ÑÐ», Ð¼ÑÑ€Ð³ÑÐ¶Ð»Ð¸Ð¹Ð½ ÑÑÑ‚Ð³ÑÐ» Ð·Ò¯Ð¹Ñ‡, ÑÐ¼Ñ‡ ÑÑÐ²ÑÐ» Ð·Ó©Ð²Ð»Ó©Ñ…Ó©Ó©Ñ Ñ‚ÑƒÑÐ»Ð°Ð¼Ð¶ Ð°Ð²Ð°Ñ… Ð½ÑŒ Ñ‡ÑƒÑ…Ð°Ð» ÑŽÐ¼.";
  } else if (testType === "sectionsTest3") {
    if (score >= 121) {
      interpretation =
        "Ð¡ÑÑ‚Ð³ÑÐ» Ñ…Ó©Ð´Ð»Ó©Ð»Ó©Ó© ÑƒÐ´Ð¸Ñ€Ð´Ð°Ñ… Ñ‡Ð°Ð´Ð°Ð¼Ð¶ Ð¼Ð°Ñˆ Ó©Ð½Ð´Ó©Ñ€. Ð¡ÑÑ‚Ð³ÑÐ» Ñ…Ó©Ð´Ð»Ó©Ð»Ó©Ó© Ð±Ò¯Ñ€ÑÐ½ Ñ…ÑÐ½Ð°Ð¶, Ð±ÑƒÑÐ°Ð´Ñ‚Ð°Ð¹ Ò¯Ñ€ Ð´Ò¯Ð½Ñ‚ÑÐ¹ Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð¶, Ñ‚ÑÐ´Ð½Ð¸Ð¹Ð³ ÑƒÑ€Ð°Ð¼ÑˆÑƒÑƒÐ»Ð°Ð½ Ð´ÑÐ¼Ð¶Ð¸Ñ… Ñ‡Ð°Ð´Ð²Ð°Ñ€Ñ‚Ð°Ð¹.";
    } else if (score >= 91 && score <= 120) {
      interpretation =
        "Ð¡ÑÑ‚Ð³ÑÐ» Ñ…Ó©Ð´Ð»Ó©Ð»Ó©Ó© ÑƒÐ´Ð¸Ñ€Ð´Ð°Ñ… Ñ‡Ð°Ð´Ð°Ð¼Ð¶ ÑÐ°Ð¹Ð½. Ó¨Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ð±Ð¾Ð»Ð¾Ð½ Ð±ÑƒÑÐ´Ñ‹Ð³ Ð¾Ð¹Ð»Ð³Ð¾Ñ…, Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð°Ð³Ð°Ð° Ð·Ð¾Ñ…Ð¸Ñ†ÑƒÑƒÐ»Ð°Ñ… Ñ‡Ð°Ð´Ð²Ð°Ñ€Ñ‚Ð°Ð¹.";
    } else if (score >= 61 && score <= 90) {
      interpretation =
        "Ð¡ÑÑ‚Ð³ÑÐ» Ñ…Ó©Ð´Ð»Ó©Ð»Ó©Ó© ÑƒÐ´Ð¸Ñ€Ð´Ð°Ñ… Ñ‡Ð°Ð´Ð°Ð¼Ð¶ Ð´ÑƒÐ½Ð´ Ð·ÑÑ€ÑÐ³. Ð—Ð°Ñ€Ð¸Ð¼Ð´Ð°Ð° ÑÑÑ‚Ð³ÑÐ» Ñ…Ó©Ð´Ð»Ó©Ð»Ó©Ó© Ñ…ÑÐ½Ð°Ñ…, Ð±ÑƒÑÐ°Ð´Ñ‚Ð°Ð¹ Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ñ…Ð°Ð´ Ð±ÑÑ€Ñ…ÑˆÑÑÐ» Ñ‚ÑƒÐ»Ð³Ð°Ñ€Ð´Ð°Ð³ Ð±Ð°Ð¹Ð¶ Ð±Ð¾Ð»Ð½Ð¾.";
    } else {
      interpretation =
        "Ð¡ÑÑ‚Ð³ÑÐ» Ñ…Ó©Ð´Ð»Ó©Ð»Ó©Ó© ÑƒÐ´Ð¸Ñ€Ð´Ð°Ñ… Ñ‡Ð°Ð´Ð°Ð¼Ð¶ Ñ…Ð°Ñ€ÑŒÑ†Ð°Ð½Ð³ÑƒÐ¹ Ð´Ð¾Ð¾Ð³ÑƒÑƒÑ€. Ó¨Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ð±Ð¾Ð»Ð¾Ð½ Ð±ÑƒÑÐ´Ñ‹Ð³ Ð¾Ð¹Ð»Ð³Ð¾Ñ…, Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð°Ð³Ð°Ð° ÑÐ°Ð¹Ð¶Ñ€ÑƒÑƒÐ»Ð°Ñ… Ñ‚Ð°Ð» Ð´ÑÑÑ€ Ð°Ð½Ñ…Ð°Ð°Ñ€Ð°Ñ… ÑˆÐ°Ð°Ñ€Ð´Ð»Ð°Ð³Ð°Ñ‚Ð°Ð¹.";
    }
    explanation = "";
  } else if (testType === "sectionsTest4") {
    if (score >= 121) {
      interpretation =
        "Ò®Ð½ÑÐ½ Ð±Ð°Ð¹Ñ… Ñ‡Ð°Ð´Ð²Ð°Ñ€ Ð¼Ð°Ñˆ Ó©Ð½Ð´Ó©Ñ€. Ð¢Ð° Ò¯Ñ€Ð³ÑÐ»Ð¶ ÑˆÑƒÐ´Ð°Ñ€Ð³Ð°, Ò¯Ð½ÑÐ½Ñ‡, Ð·Ð°Ñ€Ñ‡Ð¸Ð¼Ñ‡ Ð±Ð°Ð¹Ð´Ð°Ð³. Ð¢Ð°Ð½Ñ‹ Ò¯Ð³, Ò¯Ð¹Ð»Ð´ÑÐ» Ñ…Ð¾Ñ‘Ñ€ Ò¯Ñ€Ð³ÑÐ»Ð¶ Ñ…Ð¾Ð¾Ñ€Ð¾Ð½Ð´Ð¾Ð¾ Ñ‚Ð°Ð°Ñ€Ñ‡, Ñ‚Ð°Ð½Ñ‹ Ð½ÑÑ€ Ñ…Ò¯Ð½Ð´ Ð¼Ð°Ñˆ Ó©Ð½Ð´Ó©Ñ€ Ð±Ð°Ð¹Ð´Ð°Ð³. Ð¢Ð° Ð±ÑƒÑÐ´Ñ‹Ð½ Ð¸Ñ‚Ð³ÑÐ»Ð¸Ð¹Ð³ Ð±Ò¯Ñ€ÑÐ½ Ñ…Ò¯Ð»ÑÑÐ¶, Ð½Ð¸Ð¹Ð³ÑÐ¼ Ð±Ð¾Ð»Ð¾Ð½ Ð°Ð¶Ð¸Ð» Ð´ÑÑÑ€ÑÑ Ð¼Ð°Ð½Ð»Ð°Ð¹Ð»Ð°Ð³Ñ‡ Ð½ÑÐ³ÑÐ½ Ð±Ð°Ð¹Ð´Ð°Ð³.";
    } else if (score >= 91 && score <= 120) {
      interpretation =
        "Ò®Ð½ÑÐ½ Ð±Ð°Ð¹Ñ… Ñ‡Ð°Ð´Ð²Ð°Ñ€ ÑÐ°Ð¹Ð½. Ð¢Ð° Ð¸Ñ…ÑÐ½Ñ… Ñ‚Ð¾Ñ…Ð¸Ð¾Ð»Ð´Ð¾Ð»Ð´ ÑˆÑƒÐ´Ð°Ñ€Ð³Ð°, Ò¯Ð½ÑÐ½Ñ‡, Ð½Ð°Ð¹Ð´Ð²Ð°Ñ€Ñ‚Ð°Ð¹ Ð±Ð°Ð¹Ð´Ð°Ð³. Ð¢Ð°Ð½Ñ‹ Ñ‘Ñ Ð·Ò¯Ð¹Ð½ Ð·Ð°Ñ€Ñ‡Ð¼ÑƒÑƒÐ´ Ñ‚Ð¾Ð´Ð¾Ñ€Ñ…Ð¾Ð¹ Ð±Ó©Ð³Ó©Ó©Ð´ Ñ‚Ð° Ñ‚Ò¯Ò¯Ð½Ð¸Ð¹Ð³ÑÑ Ð±Ð°Ñ€Ð¸Ð¼Ñ‚Ð»Ð°Ñ…Ñ‹Ð³ Ñ…Ð¸Ñ‡ÑÑÐ´ÑÐ³. Ð­Ð½Ñ Ð½ÑŒ Ð±ÑƒÑÐ´Ñ‹Ð½ Ð¸Ñ‚Ð³ÑÐ»Ð¸Ð¹Ð³ Ñ…Ò¯Ð»ÑÑÐ¶, ÑÑ€Ð³ÑÐ½ Ñ‚Ð¾Ð¹Ñ€Ð¾Ð½Ð´ Ñ‚Ð°Ð½ÑŒ ÑÐµÑ€ÑÐ³ Ð½Ó©Ð»Ó©Ó© Ò¯Ð·Ò¯Ò¯Ð»Ð´ÑÐ³.";
    } else if (score >= 61 && score <= 90) {
      interpretation =
        "Ò®Ð½ÑÐ½ Ð±Ð°Ð¹Ñ… Ñ‡Ð°Ð´Ð²Ð°Ñ€ Ð´ÑƒÐ½Ð´ Ð·ÑÑ€ÑÐ³. Ð¢Ð° Ð¸Ñ…ÑÐ½Ñ… Ñ‚Ð¾Ñ…Ð¸Ð¾Ð»Ð´Ð¾Ð»Ð´ Ò¯Ð½ÑÐ½Ñ‡ Ð±Ð°Ð¹Ñ…Ñ‹Ð³ Ñ…Ð¸Ñ‡ÑÑÐ´ÑÐ³ Ñ‡, Ð·Ð°Ñ€Ð¸Ð¼Ð´Ð°Ð° Ð´Ð°Ñ€Ð°Ð¼Ñ‚ ÑÑÐ²ÑÐ» Ð°ÑˆÐ¸Ð³ ÑÐ¾Ð½Ð¸Ñ€Ñ…Ð»Ñ‹Ð½ Ò¯ÐµÐ´ Ð·Ð°Ñ€Ñ‡Ð¸Ð¼Ð´Ð°Ð° Ò¯Ð½ÑÐ½Ñ‡ Ð±Ð°Ð¹Ð¶ Ñ‡Ð°Ð´Ð´Ð°Ð³Ð³Ò¯Ð¹ Ð±Ð°Ð¹Ð¶ Ð¼Ð°Ð³Ð°Ð´Ð³Ò¯Ð¹. Ó¨Ó©Ñ€Ð¸Ð¹Ð½ Ò¯Ð½ÑÑ‚ Ð·Ò¯Ð¹Ð»ÑÑÑ Ñ‚Ð¾Ð´Ð¾Ñ€Ñ…Ð¾Ð¹Ð»Ð¶, Ñ…Ò¯Ð½Ð´ Ð½Ó©Ñ…Ñ†Ó©Ð»Ð´ Ñ‡ Ñ‚Ò¯Ò¯Ð½Ð´ÑÑ Ò¯Ð½ÑÐ½Ñ‡ Ð±Ð°Ð¹Ñ…Ñ‹Ð³ Ñ…Ð¸Ñ‡ÑÑÑ… Ð½ÑŒ Ð·Ò¯Ð¹Ñ‚ÑÐ¹.";
    } else {
      interpretation =
        "Ò®Ð½ÑÐ½ Ð±Ð°Ð¹Ñ… Ñ‡Ð°Ð´Ð²Ð°Ñ€ Ñ…Ð°Ñ€ÑŒÑ†Ð°Ð½Ð³ÑƒÐ¹ Ð´Ð¾Ð¾Ð³ÑƒÑƒÑ€. Ð¢Ð° ÑˆÑƒÐ´Ð°Ñ€Ð³Ð° Ð±Ð°Ð¹Ð´Ð°Ð», Ñ‘Ñ Ð·Ò¯Ð¹Ð½ Ð·Ð°Ñ€Ñ‡Ð¼ÑƒÑƒÐ´Ð°Ð° Ð±Ð°Ñ€Ð¸Ð¼Ñ‚Ð»Ð°Ñ…Ð°Ð´ Ð±ÑÑ€Ñ…ÑˆÑÑÐ»Ñ‚ÑÐ¹ Ð±Ð°Ð¹Ð´Ð°Ð³. Ò®Ð½ÑÐ½Ñ‡ Ð±Ð°Ð¹Ð´Ð°Ð», Ñ…Ð°Ñ€Ð¸ÑƒÑ†Ð»Ð°Ð³Ð° Ñ…Ò¯Ð»ÑÑÑ…, Ð±ÑƒÑÐ´Ñ‹Ð½ Ð¸Ñ‚Ð³ÑÐ»Ð¸Ð¹Ð³ Ñ…Ò¯Ð½Ð´Ð»ÑÑ… Ñ‚Ð°Ð» Ð´ÑÑÑ€ Ð°Ð½Ñ…Ð°Ð°Ñ€Ð°Ñ… ÑˆÐ°Ð°Ñ€Ð´Ð»Ð°Ð³Ð°Ñ‚Ð°Ð¹. Ð­Ð½Ñ Ð½ÑŒ Ñ‚Ð°Ð½Ñ‹ Ñ…ÑƒÐ²Ð¸Ð¹Ð½ Ð±Ð¾Ð»Ð¾Ð½ Ð¼ÑÑ€Ð³ÑÐ¶Ð»Ð¸Ð¹Ð½ Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð°Ð½Ð´ ÑÓ©Ñ€Ð³Ó©Ó©Ñ€ Ð½Ó©Ð»Ó©Ó©Ð»Ð¶ Ð±Ð¾Ð»Ð·Ð¾ÑˆÐ³Ò¯Ð¹.";
    }
    explanation = "Ð­Ð½ÑÑ…Ò¯Ò¯ Ñ‚ÐµÑÑ‚ Ð½ÑŒ Ð¼ÑÑ€Ð³ÑÐ¶Ð»Ð¸Ð¹Ð½ Ð¾Ð½Ð¾ÑˆÐ»Ð¾Ð³Ð¾Ð¾ Ð±Ð¸Ñˆ Ð±Ó©Ð³Ó©Ó©Ð´ Ð·Ó©Ð²Ñ…Ó©Ð½ Ñ‚Ð°Ð½Ñ‹ Ò¯Ð½ÑÐ½ Ð±Ð°Ð¹Ñ… Ñ…Ð°Ð½Ð´Ð»Ð°Ð³Ñ‹Ð½ Ñ‚Ð°Ð»Ð°Ð°Ñ€Ñ… Ó©Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ò¯Ð½ÑÐ»ÑÑ…ÑÐ´ Ñ‚ÑƒÑÐ»Ð°Ñ… Ð·Ð¾Ñ€Ð¸Ð»Ð³Ð¾Ñ‚Ð¾Ð¹ ÑŽÐ¼. Ò®Ð½ÑÐ½ Ð±Ð°Ð¹Ñ… Ñ‡Ð°Ð´Ð²Ð°Ñ€ Ð½ÑŒ Ñ…ÑƒÐ²ÑŒ Ñ…Ò¯Ð½Ð¸Ð¹ Ð¼Ó©Ð½ Ñ‡Ð°Ð½Ð°Ñ€ Ð±Ð¾Ð»Ð¾Ð²Ñ‡ Ð±Ð°Ð¹Ð½Ð³Ð° ÑÐ°Ð¹Ð¶Ñ€ÑƒÑƒÐ»Ð¶ Ð±Ð¾Ð»Ð¾Ñ… ÑƒÑ€ Ñ‡Ð°Ð´Ð²Ð°Ñ€ ÑŽÐ¼. ";
  } else if (testType === "sectionsTest5") {
    if (score >= 121) {
      interpretation =
        "Ó¨Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ò¯Ð½ÑÐ»ÑÑ… Ñ‡Ð°Ð´Ð²Ð°Ñ€ Ð¼Ð°Ñˆ Ó©Ð½Ð´Ó©Ñ€. Ð¢Ð° Ó©Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ð³Ò¯Ð½Ð·Ð³Ð¸Ð¹ Ð¾Ð¹Ð»Ð³Ð¾Ð¶, Ð´Ð°Ð²ÑƒÑƒ Ð±Ð¾Ð»Ð¾Ð½ ÑÑƒÐ» Ñ‚Ð°Ð»ÑƒÑƒÐ´Ð°Ð° Ð±Ð¾Ð´Ð¸Ñ‚Ð¾Ð¹Ð³Ð¾Ð¾Ñ€ Ò¯Ð½ÑÐ»Ð´ÑÐ³. Ð¢Ð° Ó©Ó©Ñ€Ñ‚Ó©Ó© Ð¸Ñ‚Ð³ÑÐ»Ñ‚ÑÐ¹, Ñ…Ð°Ñ€Ð¸ÑƒÑ†Ð»Ð°Ð³Ð°Ñ‚Ð°Ð¹ Ð±Ó©Ð³Ó©Ó©Ð´ Ð°Ð»Ð´Ð°Ð°Ð½Ð°Ð°ÑÐ°Ð° ÑÑƒÑ€Ð°Ð»Ñ†Ð°Ð½, Ð±Ð°Ð¹Ð½Ð³Ð° Ó©ÑÓ©Ð½ Ð´ÑÐ²Ð¶Ð¸Ñ…Ð¸Ð¹Ð³ ÑÑ€Ð¼ÑÐ»Ð·Ð´ÑÐ³. Ð¢Ð°Ð½Ñ‹ ÑÐ½Ñ Ñ‡Ð°Ð´Ð²Ð°Ñ€ Ð½ÑŒ Ñ‚Ð°Ð½Ñ‹Ð³ Ó©Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© ÑƒÐ´Ð¸Ñ€Ð´Ð°Ñ…, Ð·Ð¾Ñ€Ð¸Ð»Ð³Ð¾Ð´Ð¾Ð¾ Ñ…Ò¯Ñ€ÑÑ…, ÑÑ€Ò¯Ò¯Ð» Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð°Ð³ Ð±Ð¸Ð¹ Ð±Ð¾Ð»Ð³Ð¾Ñ…Ð¾Ð´ Ñ‡ÑƒÑ…Ð°Ð» Ò¯Ò¯Ñ€ÑÐ³ Ð³Ò¯Ð¹Ñ†ÑÑ‚Ð³ÑÐ´ÑÐ³.";
    } else if (score >= 91 && score <= 120) {
      interpretation =
        "Ó¨Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ò¯Ð½ÑÐ»ÑÑ… Ñ‡Ð°Ð´Ð²Ð°Ñ€ ÑÐ°Ð¹Ð½. Ð¢Ð° Ó©Ó©Ñ€Ð¸Ð¹Ð½ Ð´Ð°Ð²ÑƒÑƒ, ÑÑƒÐ» Ñ‚Ð°Ð»Ñ‹Ð³ Ð±Ð¾Ð´Ð¸Ñ‚Ð¾Ð¹Ð³Ð¾Ð¾Ñ€ Ò¯Ð½ÑÐ»Ð¶, Ó©Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ñ…Ó©Ð³Ð¶Ò¯Ò¯Ð»ÑÑ…Ð¸Ð¹Ð½ Ñ‚Ó©Ð»Ó©Ó© Ñ…Ð¸Ñ‡ÑÑÐ´ÑÐ³. Ð¢Ð° Ð±ÑƒÑÐ´Ñ‹Ð½ ÑˆÒ¯Ò¯Ð¼Ð¶Ð»ÑÐ»Ð¸Ð¹Ð³ Ñ…Ò¯Ð»ÑÑÐ½ Ð°Ð²Ñ‡, Ó©Ó©Ñ€Ð¸Ð¹Ð½ ÑˆÐ¸Ð¹Ð´Ð²ÑÑ€, Ò¯Ð¹Ð»Ð´Ð»ÑÑ ÑÑ€Ð³ÑÑ†Ò¯Ò¯Ð»ÑÐ½ Ð´Ò¯Ð³Ð½ÑÐ¶ Ñ‡Ð°Ð´Ð´Ð°Ð³. Ð­Ð½Ñ Ð½ÑŒ Ñ‚Ð°Ð½Ñ‹ Ñ…ÑƒÐ²Ð¸Ð¹Ð½ Ð±Ð¾Ð»Ð¾Ð½ Ð¼ÑÑ€Ð³ÑÐ¶Ð»Ð¸Ð¹Ð½ Ð°Ð¼ÑŒÐ´Ñ€Ð°Ð»Ð´ ÑÐµÑ€ÑÐ³ Ð½Ó©Ð»Ó©Ó© Ò¯Ð·Ò¯Ò¯Ð»Ð´ÑÐ³.";
    } else if (score >= 61 && score <= 90) {
      interpretation =
        "Ó¨Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ò¯Ð½ÑÐ»ÑÑ… Ñ‡Ð°Ð´Ð²Ð°Ñ€ Ð´ÑƒÐ½Ð´ Ð·ÑÑ€ÑÐ³. Ð¢Ð° Ó©Ó©Ñ€Ð¸Ð¹Ð½Ñ…Ó©Ó© Ñ‚Ð°Ð»Ð°Ð°Ñ€ Ñ‚Ð¾Ð´Ð¾Ñ€Ñ…Ð¾Ð¹ Ð¾Ð¹Ð»Ð³Ð¾Ð»Ñ‚Ñ‚Ð¾Ð¹ Ñ‡, Ð·Ð°Ñ€Ð¸Ð¼Ð´Ð°Ð° Ó©Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ñ…ÑÑ‚ Ó©Ð½Ð´Ó©Ñ€ ÑÑÐ²ÑÐ» Ñ…ÑÑ‚ Ð´Ð¾Ð¾Ð³ÑƒÑƒÑ€ Ò¯Ð½ÑÐ»ÑÑ… Ñ…Ð°Ð½Ð´Ð»Ð°Ð³Ð°Ñ‚Ð°Ð¹ Ð±Ð°Ð¹Ð¶ Ð¼Ð°Ð³Ð°Ð´Ð³Ò¯Ð¹. Ð‘ÑƒÑÐ´Ñ‹Ð½ ÑˆÒ¯Ò¯Ð¼Ð¶Ð»ÑÐ»Ð¸Ð¹Ð³ Ñ…Ò¯Ð»ÑÑÐ½ Ð°Ð²Ð°Ñ…, Ó©Ó©Ñ€Ð¸Ð¹Ð½ Ð¼ÑÐ´Ñ€ÑÐ¼Ð¶, Ð±Ð¾Ð´Ð»Ñ‹Ð³ Ð³Ò¯Ð½Ð·Ð³Ð¸Ð¹Ñ€Ò¯Ò¯Ð»ÑÐ½ Ð¾Ð¹Ð»Ð³Ð¾Ñ…, Ð°Ð»Ð´Ð°Ð°Ð½Ð°Ð°ÑÐ°Ð° ÑÑƒÑ€Ð°Ð»Ñ†Ð°Ñ…Ð°Ð´ Ð°Ð½Ñ…Ð°Ð°Ñ€Ð»Ð°Ð° Ñ…Ð°Ð½Ð´ÑƒÑƒÐ»Ð°Ñ… Ð½ÑŒ Ð·Ò¯Ð¹Ñ‚ÑÐ¹.";
    } else {
      interpretation =
        "Ó¨Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ò¯Ð½ÑÐ»ÑÑ… Ñ‡Ð°Ð´Ð²Ð°Ñ€ Ñ…Ð°Ñ€ÑŒÑ†Ð°Ð½Ð³ÑƒÐ¹ Ð´Ð¾Ð¾Ð³ÑƒÑƒÑ€. Ð¢Ð° Ó©Ó©Ñ€Ð¸Ð¹Ð½ Ð´Ð°Ð²ÑƒÑƒ, ÑÑƒÐ» Ñ‚Ð°Ð»Ñ‹Ð³ Ñ‚Ð¾Ð´Ð¾Ñ€Ñ…Ð¾Ð¹ Ð¼ÑÐ´ÑÑ…Ð³Ò¯Ð¹ Ð±Ð°Ð¹Ñ… ÑÑÐ²ÑÐ» Ó©Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ð±Ð¾Ð´Ð¸Ñ‚Ð¾Ð¹Ð³Ð¾Ð¾Ñ€ Ò¯Ð½ÑÐ»ÑÑ…ÑÐ´ Ð±ÑÑ€Ñ…ÑˆÑÑÐ»Ñ‚ÑÐ¹ Ð±Ð°Ð¹Ð´Ð°Ð³. Ó¨Ó©Ñ€Ñ‚Ó©Ó© Ð¸Ñ‚Ð³ÑÐ»Ð³Ò¯Ð¹ Ð±Ð°Ð¹Ñ…, ÑÑÐ²ÑÐ» Ñ…ÑÑ‚ Ð¸Ñ… Ó©Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© ÑˆÒ¯Ò¯Ð¼Ð¶Ð»ÑÑ… Ñ…Ð°Ð½Ð´Ð»Ð°Ð³Ð°Ñ‚Ð°Ð¹ Ð±Ð°Ð¹Ð¶ Ð±Ð¾Ð»Ð½Ð¾. Ó¨Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ñ‚Ð°Ð½Ð¸Ñ…, Ó©Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ñ…Ò¯Ð»ÑÑÐ½ Ð·Ó©Ð²ÑˆÓ©Ó©Ñ€Ó©Ñ…, Ð°Ð»Ð´Ð°Ð°Ð½Ð°Ð°ÑÐ°Ð° ÑÑƒÑ€Ð°Ð»Ñ†Ð°Ñ… Ñ‚Ð°Ð» Ð´ÑÑÑ€ Ð°Ð½Ñ…Ð°Ð°Ñ€Ð°Ñ… ÑˆÐ°Ð°Ñ€Ð´Ð»Ð°Ð³Ð°Ñ‚Ð°Ð¹.";
    }
    explanation = "Ð­Ð½ÑÑ…Ò¯Ò¯ Ñ‚ÐµÑÑ‚ Ð½ÑŒ Ð¼ÑÑ€Ð³ÑÐ¶Ð»Ð¸Ð¹Ð½ Ð¾Ð½Ð¾ÑˆÐ»Ð¾Ð³Ð¾Ð¾ Ð±Ð¸Ñˆ Ð±Ó©Ð³Ó©Ó©Ð´ Ð·Ó©Ð²Ñ…Ó©Ð½ Ñ‚Ð°Ð½Ñ‹ Ó©Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ò¯Ð½ÑÐ»ÑÑ… Ñ…Ð°Ð½Ð´Ð»Ð°Ð³Ñ‹Ð½ Ñ‚Ð°Ð»Ð°Ð°Ñ€Ñ… Ó©Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ò¯Ð½ÑÐ»ÑÑ…ÑÐ´ Ñ‚ÑƒÑÐ»Ð°Ñ… Ð·Ð¾Ñ€Ð¸Ð»Ð³Ð¾Ñ‚Ð¾Ð¹ ÑŽÐ¼. Ó¨Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ò¯Ð½ÑÐ»ÑÑ… Ñ‡Ð°Ð´Ð²Ð°Ñ€ Ð±Ð¾Ð» Ð±Ð°Ð¹Ð½Ð³Ð° Ñ…Ó©Ð³Ð¶Ò¯Ò¯Ð»Ð¶ Ð±Ð¾Ð»Ð¾Ñ… ÑƒÑ€ Ñ‡Ð°Ð´Ð²Ð°Ñ€ ÑŽÐ¼. ";
  } else if (testType === "sectionsTest6") {
    if (score >= 121) {
      interpretation =
        "Ð­Ð¼Ð¿Ð°Ñ‚Ð¸Ð¹Ð½ Ñ‚Ò¯Ð²ÑˆÐ¸Ð½ Ð¼Ð°Ñˆ Ó©Ð½Ð´Ó©Ñ€. Ð¢Ð° Ð±ÑƒÑÐ´Ñ‹Ð½ Ð¼ÑÐ´Ñ€ÑÐ¼Ð¶, Ð±Ð¾Ð´Ð¾Ð» ÑÐ°Ð½Ð°Ð°Ð³ Ð³Ò¯Ð½ Ð³Ò¯Ð½Ð·Ð³Ð¸Ð¹ Ð¾Ð¹Ð»Ð³Ð¾Ð¶, Ð¼ÑÐ´ÑÑ€Ñ‡ Ñ‡Ð°Ð´Ð´Ð°Ð³. Ð¢Ð°Ð½Ñ‹ ÑÐ¼Ð¿Ð°Ñ‚Ð¸Ð¹Ð½ Ñ‡Ð°Ð´Ð²Ð°Ñ€ Ð½ÑŒ Ð±ÑƒÑÐ°Ð´Ñ‚Ð°Ð¹ Ñ…Ò¯Ñ‡Ñ‚ÑÐ¹ Ñ…Ð¾Ð»Ð±Ð¾Ð¾ Ñ‚Ð¾Ð³Ñ‚Ð¾Ð¾Ñ…, Ò¯Ñ€ Ð´Ò¯Ð½Ñ‚ÑÐ¹ Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ñ…, Ð¼Ó©Ð½ ÑÑ€Ð³ÑÐ½ Ñ‚Ð¾Ð¹Ñ€Ð¾Ð½Ð´ Ð±Ð°Ð¹Ð³Ð°Ð° Ñ…Ò¯Ð¼Ò¯Ò¯ÑÑ‚ÑÑ ÑÐµÑ€ÑÐ³ Ð½Ó©Ð»Ó©Ó© Ò¯Ð·Ò¯Ò¯Ð»ÑÑ…ÑÐ´ Ñ‚ÑƒÑÐ°Ð»Ð´Ð°Ð³. Ð¢Ð° Ð¼Ð°Ð³Ð°Ð´Ð³Ò¯Ð¹ -ÑÐ¼Ð¿Ð°Ñ‚Ð¸Ðº Ñ…Ò¯Ð½- Ð³ÑÐ¶ Ð½ÑÑ€Ð»ÑÐ³Ð´ÑÑ… Ð½ÑŒ Ð¾Ð»Ð¾Ð½Ñ‚Ð°Ð°.";
    } else if (score >= 91 && score <= 120) {
      interpretation =
        "Ð­Ð¼Ð¿Ð°Ñ‚Ð¸Ð¹Ð½ Ñ‚Ò¯Ð²ÑˆÐ¸Ð½ ÑÐ°Ð¹Ð½. Ð¢Ð° Ð¸Ñ…ÑÐ½Ñ… Ñ‚Ð¾Ñ…Ð¸Ð¾Ð»Ð´Ð¾Ð»Ð´ Ð±ÑƒÑÐ´Ñ‹Ð½ Ð¼ÑÐ´Ñ€ÑÐ¼Ð¶, Ð±Ð¾Ð´Ð¾Ð» ÑÐ°Ð½Ð°Ð°Ð³ Ð¾Ð¹Ð»Ð³Ð¾Ð¶, Ñ‚ÑÐ´ÑÐ½Ð´ Ñ‚ÑƒÑÐ»Ð°Ñ…Ñ‹Ð³ Ñ…Ð¸Ñ‡ÑÑÐ´ÑÐ³. Ð¢Ð°Ð½Ñ‹ ÑÐ¼Ð¿Ð°Ñ‚Ð¸Ð¹Ð½ Ñ‡Ð°Ð´Ð²Ð°Ñ€ Ð½ÑŒ Ñ…Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð° Ð±Ð¾Ð»Ð¾Ð½ Ð½Ð¸Ð¹Ð³Ð¼Ð¸Ð¹Ð½ Ð°Ð¼ÑŒÐ´Ñ€Ð°Ð»Ð´ Ñ‚Ð°Ð½ÑŒ ÑÐµÑ€Ð³ÑÑÑ€ Ð½Ó©Ð»Ó©Ó©Ð»Ð´Ó©Ð³.";
    } else if (score >= 61 && score <= 90) {
      interpretation =
        "Ð­Ð¼Ð¿Ð°Ñ‚Ð¸Ð¹Ð½ Ñ‚Ò¯Ð²ÑˆÐ¸Ð½ Ð´ÑƒÐ½Ð´ Ð·ÑÑ€ÑÐ³. Ð¢Ð° Ð·Ð°Ñ€Ð¸Ð¼Ð´Ð°Ð° Ð±ÑƒÑÐ´Ñ‹Ð½ Ð¼ÑÐ´Ñ€ÑÐ¼Ð¶Ð¸Ð¹Ð³ Ð¾Ð¹Ð»Ð³Ð¾Ð´Ð¾Ð³ Ñ‡, Ð±Ò¯Ñ€ÑÐ½ Ð´Ò¯Ò¯Ñ€ÑÐ½ Ð¼ÑÐ´ÑÑ€Ñ‡, Ñ…Ð°Ñ€Ð¸Ñƒ Ò¯Ð¹Ð»Ð´ÑÐ» Ò¯Ð·Ò¯Ò¯Ð»Ð¶ Ñ‡Ð°Ð´Ð´Ð°Ð³Ð³Ò¯Ð¹ Ð±Ð°Ð¹Ð¶ Ð¼Ð°Ð³Ð°Ð´Ð³Ò¯Ð¹. Ð˜Ð´ÑÐ²Ñ…Ñ‚ÑÐ¹ ÑÐ¾Ð½ÑÐ¾Ñ…, Ó©Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ð±ÑƒÑÐ´Ñ‹Ð½ Ð¾Ñ€Ð¾Ð½Ð´ Ñ‚Ð°Ð²Ð¸Ñ… Ð´Ð°ÑÐ³Ð°Ð»ÑƒÑƒÐ´ Ñ…Ð¸Ð¹Ñ… Ð½ÑŒ Ð·Ò¯Ð¹Ñ‚ÑÐ¹.";
    } else {
      interpretation =
        "Ð­Ð¼Ð¿Ð°Ñ‚Ð¸Ð¹Ð½ Ñ‚Ò¯Ð²ÑˆÐ¸Ð½ Ñ…Ð°Ñ€ÑŒÑ†Ð°Ð½Ð³ÑƒÐ¹ Ð´Ð¾Ð¾Ð³ÑƒÑƒÑ€. Ð¢Ð° Ð±ÑƒÑÐ´Ñ‹Ð½ Ð¼ÑÐ´Ñ€ÑÐ¼Ð¶, Ñ…ÑÑ€ÑÐ³Ñ†ÑÑÐ³ Ð¾Ð¹Ð»Ð³Ð¾Ñ…Ð¾Ð´ Ð±ÑÑ€Ñ…ÑˆÑÑÐ»Ñ‚ÑÐ¹ Ð±Ð°Ð¹Ð¶ Ð±Ð¾Ð»Ð½Ð¾. Ð¥Ð°Ñ€Ð¸Ð»Ñ†Ð°Ð°, Ð±ÑƒÑÐ´Ñ‹Ð³ Ð¾Ð¹Ð»Ð³Ð¾Ñ… Ñ‡Ð°Ð´Ð²Ð°Ñ€Ð°Ð° Ñ…Ó©Ð³Ð¶Ò¯Ò¯Ð»ÑÑ…ÑÐ´ Ð¸Ð»Ò¯Ò¯ Ð°Ð½Ñ…Ð°Ð°Ñ€Ð°Ñ… ÑˆÐ°Ð°Ñ€Ð´Ð»Ð°Ð³Ð°Ñ‚Ð°Ð¹.";
    }
    explanation = "Ð­Ð½ÑÑ…Ò¯Ò¯ Ñ‚ÐµÑÑ‚ Ð½ÑŒ Ð¼ÑÑ€Ð³ÑÐ¶Ð»Ð¸Ð¹Ð½ Ð¾Ð½Ð¾ÑˆÐ»Ð¾Ð³Ð¾Ð¾ Ð±Ð¸Ñˆ Ð±Ó©Ð³Ó©Ó©Ð´ Ð·Ó©Ð²Ñ…Ó©Ð½ Ñ‚Ð°Ð½Ñ‹ ÑÐ¼Ð¿Ð°Ñ‚Ð¸Ð¹Ð½ Ñ‚Ò¯Ð²ÑˆÐ½Ð¸Ð¹ Ñ‚Ð°Ð»Ð°Ð°Ñ€Ñ… Ó©Ó©Ñ€Ð¸Ð¹Ð³Ó©Ó© Ò¯Ð½ÑÐ»ÑÑ…ÑÐ´ Ñ‚ÑƒÑÐ»Ð°Ñ… Ð·Ð¾Ñ€Ð¸Ð»Ð³Ð¾Ñ‚Ð¾Ð¹ ÑŽÐ¼. Ð­Ð¼Ð¿Ð°Ñ‚Ð¸ Ð±Ð¾Ð» Ð±Ð°Ð¹Ð½Ð³Ð° Ñ…Ó©Ð³Ð¶Ò¯Ò¯Ð»Ð¶ Ð±Ð¾Ð»Ð¾Ñ… ÑƒÑ€ Ñ‡Ð°Ð´Ð²Ð°Ñ€ ÑŽÐ¼. ";
  } else if (testType === "sectionsTest7") {
    if (score >= 121) {
      interpretation =
        "Ð¨Ò¯Ò¯Ð¼Ð¶Ð»ÑÐ»Ñ‚ ÑÑÑ‚Ð³ÑÐ»Ð³ÑÑ Ð¼Ð°Ñˆ Ó©Ð½Ð´Ó©Ñ€. Ð¢Ð° Ð°Ð»Ð¸Ð²Ð°Ð° Ð¼ÑÐ´ÑÑÐ»ÑÐ»Ð´ ÑˆÒ¯Ò¯Ð¼Ð¶Ð»ÑÐ»Ñ‚ÑÐ¹ Ñ…Ð°Ð½Ð´Ð°Ð¶, Ð½Ð°Ñ€Ð¸Ð¹Ð½ Ñ‚Ó©Ð²Ó©Ð³Ñ‚ÑÐ¹ Ð°ÑÑƒÑƒÐ´Ð»Ñ‹Ð³ Ñ‡ Ð°Ð¼Ð¶Ð¸Ð»Ñ‚Ñ‚Ð°Ð¹ ÑˆÐ¸Ð¹Ð´Ð²ÑÑ€Ð»ÑÑ… Ñ‡Ð°Ð´Ð²Ð°Ñ€Ñ‚Ð°Ð¹.";
    } else if (score >= 91 && score <= 120) {
      interpretation =
        "Ð¨Ò¯Ò¯Ð¼Ð¶Ð»ÑÐ»Ñ‚ ÑÑÑ‚Ð³ÑÐ»Ð³ÑÑ ÑÐ°Ð¹Ð½. Ð¢Ð° Ð¸Ñ…ÑÐ½Ñ… Ñ‚Ð¾Ñ…Ð¸Ð¾Ð»Ð´Ð¾Ð»Ð´ Ð¼ÑÐ´ÑÑÐ»Ð»Ð¸Ð¹Ð³ Ò¯Ð½ÑÐ»Ð¶, Ð»Ð¾Ð³Ð¸Ðº Ò¯Ð½Ð´ÑÑÐ»ÑÐ»Ñ‚ÑÐ¹ Ð´Ò¯Ð³Ð½ÑÐ»Ñ‚ Ð³Ð°Ñ€Ð³Ð°Ð¶ Ñ‡Ð°Ð´Ð´Ð°Ð³.";
    } else if (score >= 61 && score <= 90) {
      interpretation =
        "Ð¨Ò¯Ò¯Ð¼Ð¶Ð»ÑÐ»Ñ‚ ÑÑÑ‚Ð³ÑÐ»Ð³ÑÑ Ð´ÑƒÐ½Ð´ Ð·ÑÑ€ÑÐ³. Ð—Ð°Ñ€Ð¸Ð¼Ð´Ð°Ð° Ð°ÑÑƒÑƒÐ´Ð»Ñ‹Ð³ Ð³Ò¯Ð½Ð·Ð³Ð¸Ð¹Ñ€Ò¯Ò¯Ð»ÑÐ½ ÑÑƒÐ´Ð»Ð°Ñ…, Ð»Ð¾Ð³Ð¸Ðº Ð°Ð»Ð´Ð°Ð°Ð³ Ð¾Ð»Ð¾Ñ…Ð¾Ð´ Ð±ÑÑ€Ñ…ÑˆÑÑÐ» Ñ‚ÑƒÐ»Ð³Ð°Ñ€Ð´Ð°Ð³ Ð±Ð°Ð¹Ð¶ Ð±Ð¾Ð»Ð½Ð¾.";
    } else {
      interpretation =
        "Ð¨Ò¯Ò¯Ð¼Ð¶Ð»ÑÐ»Ñ‚ ÑÑÑ‚Ð³ÑÐ»Ð³ÑÑ Ñ…Ð°Ñ€ÑŒÑ†Ð°Ð½Ð³ÑƒÐ¹ Ð´Ð¾Ð¾Ð³ÑƒÑƒÑ€. ÐœÑÐ´ÑÑÐ»ÑÐ»Ð´ Ð´Ò¯Ð½ ÑˆÐ¸Ð½Ð¶Ð¸Ð»Ð³ÑÑ Ñ…Ð¸Ð¹Ñ…, Ò¯Ð½Ð´ÑÑÐ»ÑÐ»Ñ‚ÑÐ¹ Ð´Ò¯Ð³Ð½ÑÐ»Ñ‚ Ð³Ð°Ñ€Ð³Ð°Ñ… Ñ‚Ð°Ð» Ð´ÑÑÑ€ Ð°Ð½Ñ…Ð°Ð°Ñ€Ð°Ñ… ÑˆÐ°Ð°Ñ€Ð´Ð»Ð°Ð³Ð°Ñ‚Ð°Ð¹.";
    }
    explanation = "";
  } 

  const subject = `${testType} â€” Ð¢Ð°Ð½Ñ‹ Ò¯Ñ€ Ð´Ò¯Ð½ ðŸŽ‰`;
  const text = `Ð¡Ð°Ð¹Ð½ Ð±Ð°Ð¹Ð½Ð° ÑƒÑƒ!\n\n"${testType}" Ñ‚ÐµÑÑ‚Ð¸Ð¹Ð½ Ñ‚Ð°Ð½Ñ‹ Ð¾Ð½Ð¾Ð¾: ${score}/150\n\n${interpretation}\n\n${explanation}INNER.mn Ð±Ð°Ð³`;

  try {
    await mg.messages.create(process.env.MAILGUN_DOMAIN, {
      from: `INNER <postmaster@${process.env.MAILGUN_DOMAIN}>`,
      to: [email],
      subject,
      text,
    });

    console.log(`âœ… Email sent to ${email} for ${testType}`);
    res.json({ success: true });
  } catch (err) {
    console.error("âŒ Error sending email:", err);
    res.status(500).json({ success: false, message: "Failed to send email" });
  }
});

// ---------------------------
// Start server
// ---------------------------
const PORT = process.env.PORT || 3000;
app.listen(PORT, "0.0.0.0", () => {
  console.log(`ðŸš€ Server running on http://0.0.0.0:${PORT}`);
});





